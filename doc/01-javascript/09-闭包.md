# é—­åŒ…

## ğŸ“Œ ä¸€ã€é—­åŒ…çš„å®šä¹‰ï¼ˆDefinitionï¼‰

é—­åŒ…æ˜¯å‡½æ•°ä¸å…¶å¼•ç”¨çš„å¤–éƒ¨ä½œç”¨åŸŸå˜é‡ç»‘å®šå½¢æˆçš„å°é—­ç»“æ„ï¼Œå³ä½¿å‡½æ•°åœ¨å…¶å¤–éƒ¨æ‰§è¡Œç¯å¢ƒä¸­è¢«è°ƒç”¨ï¼Œè¿™äº›å˜é‡ä¾ç„¶å­˜åœ¨å¹¶å¯è®¿é—®ã€‚

é€šä¿—åœ°è¯´ï¼šä¸€ä¸ªå‡½æ•°åœ¨å®šä¹‰æ—¶â€œè®°ä½äº†â€å®ƒæ‰€å¤„çš„ä½œç”¨åŸŸé“¾ï¼Œè€Œä¸æ˜¯åœ¨æ‰§è¡Œæ—¶å†å»æŸ¥æ‰¾ä½œç”¨åŸŸã€‚

## ğŸ§ª äºŒã€ç»å…¸ç¤ºä¾‹

```js
function outer() {
  let count = 0;
  return function inner() {
    count++;
    console.log(count);
  };
}

const counter = outer();
counter(); // 1
counter(); // 2
```

åˆ†æï¼š

- inner å‡½æ•°åœ¨ outer çš„ä½œç”¨åŸŸä¸­å®šä¹‰ï¼›
- outer æ‰§è¡Œåè¿”å› innerï¼Œå³ä¾¿ outer çš„æ‰§è¡Œä¸Šä¸‹æ–‡å·²ç»é”€æ¯ï¼Œå…¶å†…éƒ¨å˜é‡ count ä»è¢« inner å¼•ç”¨ï¼›
- è¿™å°±æ˜¯é—­åŒ…çš„ä½“ç°ï¼šå†…éƒ¨å‡½æ•°â€œæŒä¹…åŒ–â€äº†å…¶å¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚

## ğŸ§  ä¸‰ã€é—­åŒ…çš„æœ¬è´¨

é—­åŒ…æ˜¯ ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰+ å‡½æ•°å¯¹è±¡ç»‘å®šçš„ç¯å¢ƒè®°å½•ï¼ˆEnvironment Recordï¼‰ã€‚

åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°åœ¨å®šä¹‰æ—¶å°±ç¡®å®šäº†å…¶ä½œç”¨åŸŸé“¾ï¼Œå³ä¾¿è¿™ä¸ªå‡½æ•°è¢«ä¼ å‡ºå½“å‰ä½œç”¨åŸŸï¼Œå®ƒä»ç„¶å¯ä»¥è®¿é—®å…¶åŸå§‹ä½œç”¨åŸŸä¸­çš„å˜é‡ â€”â€” å› ä¸ºè¿™äº›å˜é‡è¢«â€œæ•è·â€åœ¨é—­åŒ…ä¸­ï¼Œå½¢æˆäº†ä¸€ä¸ªç§æœ‰ä¸Šä¸‹æ–‡ã€‚

## ğŸ”’ å››ã€é—­åŒ…çš„å®é™…åº”ç”¨åœºæ™¯

### 1. æ•°æ®ç§æœ‰åŒ– / å°è£…å˜é‡

```js
function createStore() {
  let state = {};
  return {
    get: () => state,
    set: (key, value) => (state[key] = value),
  };
}
```

## 2. å·¥å‚å‡½æ•° / æŸ¯é‡ŒåŒ–

```js
function multiply(x) {
  return function (y) {
    return x * y;
  };
}
const double = multiply(2);
double(5); // 10
```

## 3. å¼‚æ­¥æ‰§è¡Œä¸Šä¸‹æ–‡ä¿æŒ

```js
for (var i = 0; i < 3; i++) {
  setTimeout(function () {
    console.log(i); // éƒ½æ˜¯ 3
  }, 0);
}
// ä½¿ç”¨é—­åŒ…
for (var i = 0; i < 3; i++) {
  (function (j) {
    setTimeout(function () {
      console.log(j); // 0 1 2
    }, 0);
  })(i);
}
```

## 4. å‡½æ•°é˜²æŠ–èŠ‚æµã€ç¼“å­˜å‡½æ•°

```js
function memoize(fn) {
  const cache = {};
  return function (key) {
    if (cache[key]) return cache[key];
    return (cache[key] = fn(key));
  };
}
``;
```

## ğŸ“‰ äº”ã€é—­åŒ…çš„æ½œåœ¨é—®é¢˜ä¸æ³¨æ„äº‹é¡¹

### 1. å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰

é—­åŒ…å¼•ç”¨çš„å˜é‡ä¸ä¼šè¢« GC å›æ”¶ï¼Œé™¤éå¼•ç”¨é“¾è¢«æ–­å¼€ã€‚é¢‘ç¹åˆ›å»ºé—­åŒ…ä¸”ä¸é‡Šæ”¾å¯èƒ½å¯¼è‡´æ³„æ¼ã€‚

### 2. å˜é‡å…±äº«é”™è¯¯

ä¾‹å¦‚ï¼š

```js
var arr = [];
for (var i = 0; i < 3; i++) {
  arr[i] = function () {
    console.log(i); // å…¨æ˜¯ 3
  };
}
arr[0]();
```

è§£å†³æ–¹å¼ï¼šä½¿ç”¨ let å—çº§ä½œç”¨åŸŸæˆ–ç«‹å³æ‰§è¡Œå‡½æ•°ï¼ˆIIFEï¼‰ã€‚

## ğŸ§¬ å…­ã€é—­åŒ…ä¸æ‰§è¡Œä¸Šä¸‹æ–‡çš„å…³ç³»

é—­åŒ…æœ¬è´¨ä¸Šæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­çš„ä¸€ä¸ªå¿«ç…§ï¼ˆæˆ–ä¿ç•™å¼•ç”¨ï¼‰ï¼Œå…¶ä¾èµ–äºï¼š

- Lexical Environmentï¼ˆè¯æ³•ç¯å¢ƒï¼‰
- Variable Environment
- Scope Chain

å‡½æ•°åœ¨åˆ›å»ºæ—¶å°±æ•è·äº†å®ƒçš„å¤–éƒ¨è¯æ³•ç¯å¢ƒï¼Œè¿™å°±æ˜¯ JavaScript é‡‡ç”¨è¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopeï¼‰çš„ä½“ç°ã€‚

## âœ… ä¸ƒã€æ€»ç»“

| ç‰¹æ€§         | è¯´æ˜                               |
| ------------ | ---------------------------------- |
| æŒä¹…ä½œç”¨åŸŸ   | å³ä½¿å¤–éƒ¨å‡½æ•°å·²è¿”å›ï¼Œå˜é‡ä»ç„¶å¯è®¿é—® |
| ç”¨é€”å¹¿æ³›     | ç§æœ‰å˜é‡ã€ç¼“å­˜ã€å»¶è¿Ÿè®¡ç®—ã€æŸ¯é‡ŒåŒ–ç­‰ |
| ä¸ GC æœ‰å…³è” | å˜é‡è¢«é—­åŒ…å¼•ç”¨å³ä¸ä¼šè¢«å›æ”¶         |
| éœ€è¦æ³¨æ„æ€§èƒ½ | ç‰¹åˆ«æ˜¯åœ¨å¾ªç¯æˆ–äº‹ä»¶ä¸­åˆ›å»ºé—­åŒ…       |

é—­åŒ…æ˜¯ JavaScript å¼ºå¤§è¡¨è¾¾èƒ½åŠ›çš„æ ¸å¿ƒåŸºçŸ³ä¹‹ä¸€ï¼Œæ˜¯ç†è§£ JS æ‰§è¡Œæ¨¡å‹ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚
