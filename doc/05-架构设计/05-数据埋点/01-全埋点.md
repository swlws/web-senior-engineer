# 全埋点

## 🔎 什么是全埋点

全埋点是相对 手动埋点（代码埋点） 的概念。

- 手动埋点：开发在代码中明确调用埋点方法，比如：
  ```js
  track("click_button", { id: "login" });
  ```
- 全埋点：SDK 自动收集用户在页面上的行为（如点击、输入、浏览、滚动等），无需开发逐个写埋点代码，采集到数据后再通过后台规则配置来分析。

## ⚙️ 全埋点的常见采集方式

1. DOM 事件监听

- 自动监听 click、change、submit、scroll 等事件
- 通过事件冒泡获取触发元素及其属性（如 class、id、data-\*）

2. 可视化配置

- 平台提供「可视化圈选」功能，运营/产品在页面上点选元素，即可定义埋点规则
- 常见于 GrowingIO、神策、友盟

3. WebView/Hybrid 支持

- 通过注入 JS Bridge，将 H5 事件上报到 Native SDK

4. 日志上报方式

- navigator.sendBeacon()（推荐，页面卸载时仍能发送）
- fetch / XMLHttpRequest

## 📊 全埋点的优缺点

✅ 优点

- 开发成本低：不需要前端写很多埋点代码
- 上线快：可视化配置埋点，灵活调整
- 覆盖面广：可以自动记录大部分交互事件

❌ 缺点

- 数据冗余：可能采集了很多没用的事件，数据量大
- 语义不清晰：自动采集的事件名往往没有业务语义，需要后期清洗
- 性能影响：频繁事件（如 scroll、input）可能增加性能开销
- 复杂场景不足：如“点击某按钮后再输入内容”这种业务语义，仍需手动埋点

## 🛠️ 常见支持全埋点的工具

- GrowingIO → 国内最早做全埋点 & 可视化圈选
- 神策数据（SensorsData） → 支持全埋点、代码埋点、可视化埋点三种模式
- 友盟+ → 移动端为主，Web 也支持全埋点
- Mixpanel / Amplitude → 国外同类工具，支持 auto track
- 自研方案：基于 MutationObserver + DOM 事件监听

## 🚀 典型实现思路（简化版示例）

```js
// 简易全埋点 SDK
document.addEventListener("click", (e) => {
  const target = e.target;
  const eventData = {
    type: "click",
    tag: target.tagName,
    id: target.id,
    class: target.className,
    text: target.innerText?.slice(0, 20),
    path: location.pathname,
    timestamp: Date.now(),
  };

  navigator.sendBeacon("/track", JSON.stringify(eventData));
});
```
