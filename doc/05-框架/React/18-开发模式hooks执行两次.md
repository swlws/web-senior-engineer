# å¼€å‘æ¨¡å¼ hooks æ‰§è¡Œä¸¤æ¬¡

ä¸ºä»€ä¹ˆåœ¨ React å¼€å‘æ¨¡å¼ï¼ˆdevelopmentï¼‰ ä¸‹ç»„ä»¶ã€useEffectã€useCallbackã€useMemo ç­‰ Hook ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œè€Œåœ¨ ç”Ÿäº§æ¨¡å¼ï¼ˆproductionï¼‰ ä¸‹åªæ‰§è¡Œä¸€æ¬¡ã€‚

## ğŸ§© ä¸€ã€é—®é¢˜è¡¨ç°

åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œä½ å¯èƒ½çœ‹åˆ°ï¼š

```js
function App() {
  console.log("App render");
  useEffect(() => {
    console.log("effect run");
  }, []);
  return <div>hi</div>;
}
```

æ§åˆ¶å°è¾“å‡ºï¼š

```bash
App render
App render
effect run
```

## ğŸ§  äºŒã€æ ¹æœ¬åŸå› ï¼šReact.StrictModeï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰

### ğŸ”¹ StrictMode æ˜¯ä»€ä¹ˆ

React 18+ é»˜è®¤åœ¨å¼€å‘ç¯å¢ƒä¸­ä¼šå¼€å¯ <React.StrictMode> åŒ…è£¹ï¼š

```js
const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

> âœ… å®ƒåªåœ¨ å¼€å‘æ¨¡å¼ ä¸‹ç”Ÿæ•ˆã€‚
> åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒStrictMode å®Œå…¨ä¸ä¼šè§¦å‘é¢å¤–é€»è¾‘ã€‚

## ğŸ¯ ä¸‰ã€ä¸ºä»€ä¹ˆè¦â€œæ‰§è¡Œä¸¤æ¬¡â€ï¼Ÿ

React å®˜æ–¹æ–‡æ¡£è§£é‡Šå¾—éå¸¸æ¸…æ¥šï¼š

> React ä¼šåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æœ‰æ„åœ°é‡å¤æ‰§è¡Œ`éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸ`é€»è¾‘ï¼ˆåŒ…æ‹¬`å‡½æ•°ç»„ä»¶æœ¬èº«`ï¼‰ï¼Œä»¥å¸®åŠ©ä½ å‘ç°ä¸å®‰å…¨çš„å‰¯ä½œç”¨ã€‚

æ¢å¥è¯è¯´ï¼Œè¿™ä¸æ˜¯ bugï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒè¯•æœºåˆ¶ã€‚

### ğŸ§© ç›®çš„

åœ¨ React çš„æ–°æ¶æ„ï¼ˆConcurrent Renderingï¼‰ä¸­ï¼Œæ¸²æŸ“æ˜¯å¯ä¸­æ–­ã€å¯é‡è¯•çš„ã€‚
å› æ­¤ React æƒ³ç¡®ä¿ï¼š

- ä½ çš„ç»„ä»¶ ä¸ä¼šåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å¼•èµ·`å‰¯ä½œç”¨ï¼ˆside effectsï¼‰`ï¼›
- æ¸²æŸ“é€»è¾‘æ˜¯`çº¯å‡½æ•°å¼`çš„ï¼Œå¯ä»¥å®‰å…¨åœ°é‡å¤æ‰§è¡Œã€‚

### ğŸ” è¢«â€œæ‰§è¡Œä¸¤æ¬¡â€çš„èŒƒå›´

ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReact ä¼šåŒè°ƒç”¨ä»¥ä¸‹å†…å®¹ï¼š

| ç±»å‹                     | æ˜¯å¦æ‰§è¡Œä¸¤æ¬¡            |
| ------------------------ | ----------------------- |
| å‡½æ•°ç»„ä»¶æœ¬èº«             | âœ… æ˜¯                   |
| `useState` åˆå§‹å€¼å‡½æ•°    | âœ… æ˜¯                   |
| `useEffect` æ¸…ç† & æ‰§è¡Œ  | âœ… æ˜¯                   |
| `useMemo` åˆå§‹åŒ–å‡½æ•°     | âœ… æ˜¯                   |
| `useCallback` åˆå§‹åŒ–å‡½æ•° | âœ… æ˜¯                   |
| `useRef` åˆå§‹å€¼å‡½æ•°      | âœ… æ˜¯ï¼ˆä»…ç¬¬ä¸€æ¬¡æ¸²æŸ“å†…ï¼‰ |

## ğŸ§ª å››ã€ä¸¾ä¾‹éªŒè¯

```jsx
function App() {
  const [count, setCount] = useState(() => {
    console.log("ğŸ§© useState init");
    return 0;
  });

  const ref = useRef(() => {
    console.log("ğŸ§© useRef init");
  });

  useEffect(() => {
    console.log("ğŸ¯ useEffect run");
    return () => console.log("ğŸ§¹ cleanup");
  }, []);

  console.log("ğŸ” render");
  return <button onClick={() => setCount((c) => c + 1)}>+</button>;
}
```

å¼€å‘æ¨¡å¼ä¸‹è¾“å‡ºï¼š

```bash
ğŸ§© useState init
ğŸ§© useRef init
ğŸ” render
ğŸ§© useState init
ğŸ§© useRef init
ğŸ” render
ğŸ§¹ cleanup
ğŸ¯ useEffect run
```

## âš™ï¸ äº”ã€ç”Ÿäº§æ¨¡å¼ä¸‹ä¸ä¼šåŒæ‰§è¡Œ

å¦‚æœä½ ç”¨ï¼š

```bash
npm run build
serve -s build
```

å†æ‰“å¼€æ§åˆ¶å°ï¼Œä¼šå‘ç°åªè¾“å‡ºä¸€æ¬¡ã€‚
StrictMode åœ¨ç”Ÿäº§æ„å»ºä¸­ä¸ä¼šè§¦å‘åŒæ‰§è¡Œã€‚

## ğŸš§ å…­ã€å¦‚ä½•ä¸´æ—¶å…³é—­ä¸¥æ ¼æ¨¡å¼ï¼ˆä»…è°ƒè¯•ï¼‰

æ‰¾åˆ°å…¥å£æ–‡ä»¶ï¼ˆä¾‹å¦‚ main.jsx æˆ– index.jsï¼‰ï¼š

```jsx
// åŸæ¥æ˜¯è¿™æ ·ï¼š
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

// æ”¹æˆè¿™æ ·ï¼ˆä»…æµ‹è¯•ç”¨ï¼‰
root.render(<App />);
```

è¿™æ ·ä½ ä¼šçœ‹åˆ°ç»„ä»¶åªæ¸²æŸ“ä¸€æ¬¡ã€‚
âš ï¸ ä¸æ¨èé•¿æœŸå…³é—­ï¼Œå®ƒåœ¨å¼€å‘é˜¶æ®µå¾ˆæœ‰ä»·å€¼ã€‚

## âœ… ä¸ƒã€æ€»ç»“

| ç°è±¡                       | åŸå›                      | è¯´æ˜               |
| -------------------------- | ------------------------ | ------------------ |
| å‡½æ•°ç»„ä»¶æ‰§è¡Œä¸¤æ¬¡           | React.StrictMode         | React æœ‰æ„é‡å¤æ¸²æŸ“ |
| useEffect æ‰§è¡Œä¸¤æ¬¡         | React ä¸¥æ ¼æ¨¡å¼æµ‹è¯•å‰¯ä½œç”¨ | ç¡®ä¿æ¸…ç†é€»è¾‘æ­£ç¡®   |
| useRefã€useState init é‡è·‘ | æ¨¡æ‹ŸæŒ‚è½½-å¸è½½æµç¨‹        | éªŒè¯å¯é‡å…¥æ€§       |
| ç”Ÿäº§æ¨¡å¼åªæ‰§è¡Œä¸€æ¬¡         | StrictMode ä»…åœ¨ dev ç”Ÿæ•ˆ | æ€§èƒ½æ— å½±å“         |
