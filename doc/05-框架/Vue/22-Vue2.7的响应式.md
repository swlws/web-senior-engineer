# Vue2.7 的响应式

- Vue 2.7 的响应式系统仍然不是 Proxy
- 仍然使用 Object.defineProperty（Gingerbread 响应式系统）

Vue 2.7 引入了 Composition API，但 响应式核心仍然是 Vue2 的旧系统，不是 Vue3 的 Proxy 响应式。

## 📌 为什么 Vue 2.7 不能用 Proxy？

因为：

- Vue 2.x 的响应式系统深度耦合在整个运行时（observer、dep、watcher）中
- 使用了依赖收集 Dep class、Watcher class
- defineProperty 的 getter/setter 是整个架构核心
- Proxy 会破坏大量内部依赖
- Vue 2.x 的 SSR、组件实例结构、虚拟 DOM 依赖现有响应式结构
- Vue 团队明确说过：
  要用 Proxy，必须重写整个源码 → 这就是 Vue 3 的诞生原因

所以 Vue 2.7 只是 Vue2 系的最后一个版本，不可能大改底层。

## 📌 Vue 2.7 的 Composition API（setup / ref / reactive）是如何实现的？

简而言之：

- ref / reactive 是由插件（现在内置）模拟出来的
- 实际底层仍然走 Vue2 的 defineProperty 响应式系统
- reactive() 内部封装了 Vue.observable()
- computed() 用了 Vue2 的 Watcher 实现
- watch() 用的也是 Vue2 的 Watcher API

### 简单结构

| 功能         | Vue 2.7 实现                               |
| ------------ | ------------------------------------------ |
| `reactive()` | 基于 `Vue.observable()` 实现               |
| `ref()`      | 用 defineProperty 模拟 value getter/setter |
| `computed()` | 基于 Vue2 Watcher                          |
| `watch()`    | 基于 Vue2 Watcher 和回调                   |
| `setup()`    | 生命周期和逻辑注入层                       |

Vue 2 版本的 Composition API 完全是“模拟版本”，不是 Proxy 架构。

## 📌 对比：Vue 2.7 vs Vue 3 响应式系统

| 功能点             | Vue 2.7                   | Vue 3    |
| ------------------ | ------------------------- | -------- |
| 响应式底层         | defineProperty            | Proxy    |
| 能检测新增属性     | ❌                        | ✔        |
| 能检测数组下标修改 | ❌                        | ✔        |
| 性能               | 中                        | 高       |
| 深层监听成本       | 高                        | 低       |
| set/delete hack    | 需要 Vue.set / Vue.delete | 不需要   |
| composition api    | 模拟实现                  | 原生实现 |
| tree-shaking       | 限制                      | 完全支持 |

Vue 3 的响应式是完全重写的 `（@vue/reactivity）`，性能、能力都远超 Vue2。

## 📌 Vue 官方明确说明（关键）

Vue 2.7 的发布说明中写明：

> Vue 2.7 将继续使用 Vue 2 的响应式系统（defineProperty），不会迁移到 Vue 3 的 Proxy。

这是为了：

- 保持兼容性
- 避免破坏生态
- 确保升级成本低
- 不做破坏性大改（否则就成了 Vue3）

## 📌 结论总结

- Vue 2.7 没有 Proxy 响应式
- 仍然完全基于 Object.defineProperty
- Composition API 是 Vue2 的模拟实现，而不是 Vue3 的响应式系统
- Vue 2.7 的 reactive/ref/computed 的本质都依赖旧响应式系统
- Vue 3 才是基于 Proxy 的全新架构
