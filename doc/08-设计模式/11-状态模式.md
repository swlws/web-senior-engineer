# çŠ¶æ€æ¨¡å¼

> çŠ¶æ€æ¨¡å¼ = å¯¹è±¡çš„è¡Œä¸ºéšçŠ¶æ€å˜åŒ–è€Œå˜åŒ–ï¼Œè€Œæ— éœ€æ¡ä»¶åˆ¤æ–­

ç›¸æ¯”ä¼ ç»Ÿçš„ if/else æˆ– switch åˆ¤æ–­çŠ¶æ€ï¼ŒçŠ¶æ€æ¨¡å¼å°†æ¯ä¸ªçŠ¶æ€å°è£…æˆç‹¬ç«‹ç±»ï¼Œä½¿ä»£ç æ›´æ¸…æ™°ã€æ˜“æ‰©å±•ã€‚

ä½¿ç”¨åœºæ™¯

- å¯¹è±¡è¡Œä¸ºéšçŠ¶æ€ä¸åŒè€Œå˜åŒ–
- é¿å…å¤§é‡ if/else æˆ– switch è¯­å¥
- éœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢çŠ¶æ€
- æ¯”å¦‚ï¼š
  - UI æŒ‰é’®çŠ¶æ€ï¼ˆå¯ç”¨ / ç¦ç”¨ / åŠ è½½ä¸­ï¼‰
  - TCP è¿æ¥çŠ¶æ€ï¼ˆå…³é—­ / å»ºç«‹ / ç›‘å¬ / å…³é—­ä¸­ï¼‰
  - æ¸¸æˆè§’è‰²çŠ¶æ€ï¼ˆè·‘æ­¥ / è·³è·ƒ / æ”»å‡» / æ­»äº¡ï¼‰

## ğŸ”§ æ¨¡å¼ç»“æ„

| è§’è‰²                      | è¯´æ˜               |
| ----------------------- | ---------------- |
| **Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰**        | ä¿å­˜å½“å‰çŠ¶æ€ï¼Œç»´æŠ¤çŠ¶æ€åˆ‡æ¢    |
| **Stateï¼ˆçŠ¶æ€æ¥å£ï¼‰**         | å®šä¹‰çŠ¶æ€è¡Œä¸ºæ¥å£         |
| **ConcreteStateï¼ˆå…·ä½“çŠ¶æ€ï¼‰** | å®ç°ä¸åŒçŠ¶æ€çš„è¡Œä¸ºï¼Œå¹¶å¯åˆ‡æ¢çŠ¶æ€ |

## ğŸ’¡ ç¤ºä¾‹ä¸€ï¼šç®€å•å¼€å…³çŠ¶æ€

```js
// çŠ¶æ€æ¥å£
class State {
  handle(context) {}
}

// å…·ä½“çŠ¶æ€ï¼šå¼€
class OnState extends State {
  handle(context) {
    console.log('ç¯å·²æ‰“å¼€ ğŸ’¡');
    context.setState(new OffState());
  }
}

// å…·ä½“çŠ¶æ€ï¼šå…³
class OffState extends State {
  handle(context) {
    console.log('ç¯å·²å…³é—­ ğŸ”Œ');
    context.setState(new OnState());
  }
}

// ä¸Šä¸‹æ–‡
class Light {
  constructor() {
    this.state = new OffState(); // åˆå§‹çŠ¶æ€
  }

  setState(state) {
    this.state = state;
  }

  pressSwitch() {
    this.state.handle(this);
  }
}

// ä½¿ç”¨
const light = new Light();
light.pressSwitch(); // ç¯å·²å…³é—­ ğŸ”Œ â†’ åˆ‡æ¢åˆ°å¼€çŠ¶æ€
light.pressSwitch(); // ç¯å·²æ‰“å¼€ ğŸ’¡ â†’ åˆ‡æ¢åˆ°å…³çŠ¶æ€
light.pressSwitch(); // ç¯å·²å…³é—­ ğŸ”Œ
```

æ¯æ¬¡æŒ‰å¼€å…³ï¼Œè¡Œä¸ºéšçŠ¶æ€å˜åŒ–ï¼Œé€»è¾‘æ¸…æ™°ï¼Œæ—  if/elseã€‚

## ğŸ’¡ ç¤ºä¾‹äºŒï¼šå‰ç«¯æŒ‰é’®çŠ¶æ€

```js
class Button {
  constructor() {
    this.state = new EnabledState(this);
  }

  setState(state) {
    this.state = state;
  }

  click() {
    this.state.click();
  }
}

// çŠ¶æ€æ¥å£
class ButtonState {
  constructor(button) {
    this.button = button;
  }

  click() {}
}

// å¯ç‚¹å‡»çŠ¶æ€
class EnabledState extends ButtonState {
  click() {
    console.log('æŒ‰é’®è¢«ç‚¹å‡» âœ…');
    this.button.setState(new DisabledState(this.button));
  }
}

// ç¦ç”¨çŠ¶æ€
class DisabledState extends ButtonState {
  click() {
    console.log('æŒ‰é’®ä¸å¯ç‚¹å‡» âŒ');
  }
}

// ä½¿ç”¨
const btn = new Button();
btn.click(); // æŒ‰é’®è¢«ç‚¹å‡» âœ…
btn.click(); // æŒ‰é’®ä¸å¯ç‚¹å‡» âŒ
```

å°†æŒ‰é’®é€»è¾‘å’ŒçŠ¶æ€è¡Œä¸ºè§£è€¦ï¼Œæ˜“äºæ‰©å±•æ›´å¤šçŠ¶æ€ã€‚

## ğŸ’¡ ç¤ºä¾‹ä¸‰ï¼šTCP è¿æ¥çŠ¶æ€ï¼ˆçœŸå®åœºæ™¯ï¼‰

```js
class TCPConnection {
  constructor() {
    this.state = new ClosedState(this);
  }

  setState(state) {
    this.state = state;
  }

  open() { this.state.open(); }
  close() { this.state.close(); }
}

class State {
  constructor(conn) { this.conn = conn; }
  open() {}
  close() {}
}

class ClosedState extends State {
  open() {
    console.log('TCP å·²å»ºç«‹è¿æ¥');
    this.conn.setState(new OpenState(this.conn));
  }
}

class OpenState extends State {
  close() {
    console.log('TCP å…³é—­è¿æ¥');
    this.conn.setState(new ClosedState(this.conn));
  }
}

// ä½¿ç”¨
const tcp = new TCPConnection();
tcp.open();  // TCP å·²å»ºç«‹è¿æ¥
tcp.close(); // TCP å…³é—­è¿æ¥
```

çŠ¶æ€åˆ‡æ¢é€»è¾‘å°è£…åœ¨çŠ¶æ€ç±»ä¸­ï¼ŒContext ç±»æ— éœ€å…³å¿ƒç»†èŠ‚ã€‚

## âœ… ä¼˜ç¼ºç‚¹æ€»ç»“

| ä¼˜ç‚¹                     | ç¼ºç‚¹                 |
| ---------------------- | ------------------ |
| å°†çŠ¶æ€å’Œè¡Œä¸ºå°è£…åœ¨ç‹¬ç«‹ç±»ä¸­ï¼Œé¿å…å¤§é‡æ¡ä»¶åˆ¤æ–­ | çŠ¶æ€ç±»æ•°é‡å¢åŠ ï¼Œç³»ç»Ÿå¤æ‚åº¦æé«˜    |
| çŠ¶æ€åˆ‡æ¢æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•æ–°çŠ¶æ€         | å®ç°ç¨å¾®å¤æ‚ï¼Œéœ€è¦ç»´æŠ¤ä¸Šä¸‹æ–‡å’ŒçŠ¶æ€ç±» |
| ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆæ–°å¢çŠ¶æ€æ— éœ€ä¿®æ”¹åŸæœ‰ç±»ï¼‰    | â€”                  |

## ğŸ“˜ å¸¸è§ä½¿ç”¨åœºæ™¯

| åœºæ™¯          | ç¤ºä¾‹              |
| ----------- | --------------- |
| UI çŠ¶æ€åˆ‡æ¢     | æŒ‰é’®çŠ¶æ€ã€åŠ è½½çŠ¶æ€ã€ç¦ç”¨/å¯ç”¨ |
| æµç¨‹æ§åˆ¶        | è¡¨å•æµç¨‹ã€è®¢å•æµç¨‹ã€å®¡æ‰¹çŠ¶æ€  |
| æ¸¸æˆå¼€å‘        | è§’è‰²çŠ¶æ€ï¼ˆè·‘ã€è·³ã€æ”»å‡»ã€æ­»äº¡ï¼‰ |
| ç½‘ç»œåè®®        | TCPã€HTTP çŠ¶æ€æœº    |
| ç¼–è¾‘å™¨ / ä½ä»£ç å¹³å° | å…ƒç´ é€‰ä¸­ã€æ‹–æ‹½ã€é”å®šçŠ¶æ€    |
