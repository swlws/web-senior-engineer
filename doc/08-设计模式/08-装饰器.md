# è£…é¥°å™¨æ¨¡å¼

| è§’è‰²                           | è¯´æ˜                      |
| ---------------------------- | ----------------------- |
| **Componentï¼ˆæŠ½è±¡ç»„ä»¶ï¼‰**          | å®šä¹‰åŸºæœ¬åŠŸèƒ½æ¥å£                |
| **ConcreteComponentï¼ˆå…·ä½“ç»„ä»¶ï¼‰**  | åŸå§‹åŠŸèƒ½å®ç°                  |
| **Decoratorï¼ˆæŠ½è±¡è£…é¥°å™¨ï¼‰**         | æŒæœ‰ Component å¼•ç”¨ï¼Œå¹¶å®ç°ç›¸åŒæ¥å£ |
| **ConcreteDecoratorï¼ˆå…·ä½“è£…é¥°å™¨ï¼‰** | åœ¨åŸåŠŸèƒ½åŸºç¡€ä¸Šå¢å¼ºåŠŸèƒ½             |

## ğŸ’¡ ç¤ºä¾‹ä¸€ï¼šåŸºç¡€å®ç°

```js
// æŠ½è±¡ç»„ä»¶
class Coffee {
  cost() {
    return 10;
  }
}

// å…·ä½“è£…é¥°å™¨ï¼šåŠ ç‰›å¥¶
class MilkDecorator {
  constructor(coffee) {
    this.coffee = coffee;
  }

  cost() {
    return this.coffee.cost() + 5;
  }
}

// å…·ä½“è£…é¥°å™¨ï¼šåŠ ç³–
class SugarDecorator {
  constructor(coffee) {
    this.coffee = coffee;
  }

  cost() {
    return this.coffee.cost() + 2;
  }
}

// ä½¿ç”¨
let coffee = new Coffee();
coffee = new MilkDecorator(coffee);
coffee = new SugarDecorator(coffee);

console.log('æœ€ç»ˆä»·æ ¼ï¼š', coffee.cost()); // 17
```

## ğŸ’¡ ç¤ºä¾‹äºŒï¼šå‡½æ•°è£…é¥°ï¼ˆå¸¸ç”¨ï¼‰

è£…é¥°å™¨æ¨¡å¼åœ¨å‡½æ•°ä¸–ç•Œé‡Œéå¸¸å¸¸è§ï¼Œæ¯”å¦‚ç»™å‡½æ•°åŠ æ—¥å¿—ã€æ€§èƒ½ç»Ÿè®¡ã€ç¼“å­˜ç­‰ã€‚

```js
function withLog(fn) {
  return function (...args) {
    console.log(`è°ƒç”¨å‡½æ•°ï¼š${fn.name}ï¼Œå‚æ•°ï¼š`, args);
    const result = fn.apply(this, args);
    console.log(`è¿”å›ç»“æœï¼š`, result);
    return result;
  };
}

function add(a, b) {
  return a + b;
}

const loggedAdd = withLog(add);

loggedAdd(2, 3);
// è°ƒç”¨å‡½æ•°ï¼šaddï¼Œå‚æ•°ï¼š[2, 3]
// è¿”å›ç»“æœï¼š5
```

## ğŸ’¡ ç¤ºä¾‹ä¸‰ï¼šES7 è£…é¥°å™¨è¯­æ³•ï¼ˆç±»/æ–¹æ³•ï¼‰

ç°ä»£ JavaScriptï¼ˆåœ¨ TypeScript / Babel ä¸­ï¼‰æ”¯æŒ @decorator è¯­æ³•ç³–ï¼Œ
å¯ç›´æ¥ä¿®é¥°ç±»ã€å±æ€§æˆ–æ–¹æ³•ã€‚

```js
// æ–¹æ³•è£…é¥°å™¨ï¼šç»Ÿè®¡æ‰§è¡Œæ—¶é—´
function timeLogger(target, key, descriptor) {
  const original = descriptor.value;
  descriptor.value = function (...args) {
    const start = performance.now();
    const result = original.apply(this, args);
    console.log(`${key} æ‰§è¡Œè€—æ—¶ï¼š${performance.now() - start}ms`);
    return result;
  };
  return descriptor;
}

class Calculator {
  @timeLogger
  add(a, b) {
    return a + b;
  }
}

// ä½¿ç”¨
new Calculator().add(5, 8);
```

## ğŸ’¡ ç¤ºä¾‹å››ï¼šVue / React ä¸­çš„è£…é¥°å™¨åº”ç”¨

### Vue (mixin è£…é¥°æ€æƒ³)

```js
function withLog(component) {
  return {
    ...component,
    created() {
      console.log(`ç»„ä»¶ ${component.name} åˆ›å»º`);
      component.created && component.created.call(this);
    }
  };
}
```

### React HOCï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰ä¹Ÿæ˜¯è£…é¥°å™¨æ¨¡å¼

```js
function withLog(WrappedComponent) {
  return function (props) {
    console.log(`æ¸²æŸ“ç»„ä»¶ï¼š${WrappedComponent.name}`);
    return <WrappedComponent {...props} />;
  };
}
```

## âœ… ä¼˜ç¼ºç‚¹æ€»ç»“

| ä¼˜ç‚¹             | ç¼ºç‚¹          |
| -------------- | ----------- |
| åŠ¨æ€æ‰©å±•å¯¹è±¡åŠŸèƒ½ï¼Œä¸ä¿®æ”¹æºç  | å±‚å±‚åµŒå¥—ä¼šè®©è°ƒè¯•å˜å¤æ‚ |
| æ›¿ä»£ç»§æ‰¿ï¼Œæ›´çµæ´»       | å¤šå±‚è£…é¥°å¯èƒ½éš¾ä»¥ç†è§£  |
| ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆOCPï¼‰    | éœ€è¦ç¡®ä¿æ¥å£ä¸€è‡´æ€§   |

## ğŸ“˜ å¸¸è§ä½¿ç”¨åœºæ™¯

| åœºæ™¯     | ç¤ºä¾‹                       |
| ------ | ------------------------ |
| å‡½æ•°å¢å¼º   | æ—¥å¿—ã€ç¼“å­˜ã€æ€§èƒ½ç»Ÿè®¡               |
| è¯·æ±‚å¢å¼º   | Axios è¯·æ±‚å‰åæ‹¦æˆª             |
| ç»„ä»¶å¢å¼º   | React HOCã€Vue mixin      |
| ç±»å¢å¼º    | TypeScript / Babel è£…é¥°å™¨è¯­æ³• |
| åŠ¨æ€åŠŸèƒ½æ‰©å±• | åŠ¨æ€æƒé™æ§åˆ¶ã€åŸ‹ç‚¹                |
