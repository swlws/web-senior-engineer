# 无感录屏

在用户无感知的情况下，录制用户在页面的操作行为

## 业务价值

- 用于排查 bug。
- 安全审计。敏感页面操作时，记录用户操作行为，方便后续审计。

## 方案设计

基于 RRWeb 实现，在 RRWeb 的基础上。分为两部分：

- 录制。
  - 产生 JSON 数据
- 上报。
  - 数据临时存储于 IndexDB
  - 上报逻辑，上报成功后，删除 IndexDB 中的数据
    - 页面加载时，检查 IndexDB 是否有未上报数据，有则上报
    - 定时上报
    - 页面关闭前上报
- 播放。
  - 后端从 ES 中拉取数据
  - 前端按需分段拉取视频数据
  - 前端使用 RRWeb-Player 播放视频

## 问题点

1. 视频生成逻辑控制
   - 路由变化时，新建录制
   - 跨整点时，新建录制
   - 视频过短（小于 3 秒）时，删除
2. 数据瘦身
   - 去除不必要的`全量快照`，减少视频体积
   - 去除空白片段。连续 N 秒无鼠标移动事件触发时，认为是空白片段，直接删除
3. 视频压缩
   - 视频后端存储于 ES，启用 ES 的压缩功能
   - 全网每日数据量在 10GB 左右，数据存留时间为 3 个月
