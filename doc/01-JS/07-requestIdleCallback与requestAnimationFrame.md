# requestIdleCallback ä¸ requestAnimationFrame

è¿™ä¸¤ä¸ª API éƒ½æ˜¯æµè§ˆå™¨æä¾›çš„å¼‚æ­¥ä»»åŠ¡è°ƒåº¦å·¥å…·ï¼Œä½†ç”¨é€”ã€æ‰§è¡Œæ—¶æœºå’Œåœºæ™¯å®Œå…¨ä¸åŒã€‚

## ğŸ†š æ ¸å¿ƒå¯¹æ¯”è¡¨

| ç‰¹æ€§         | `requestIdleCallback`                  | `requestAnimationFrame` |
| ---------- | -------------------------------------- | ----------------------- |
| ä¸»è¦ç”¨é€”       | åˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´æ‰§è¡Œâ€œéç´§æ€¥â€ä»»åŠ¡                     | åœ¨ä¸‹ä¸€å¸§æ¸²æŸ“å‰æ‰§è¡Œâ€œåŠ¨ç”»ç›¸å…³â€ä»»åŠ¡       |
| æ‰§è¡Œæ—¶æœº       | æµè§ˆå™¨ä¸»çº¿ç¨‹ç©ºé—²æ—¶                              | ä¸‹ä¸€å¸§ç»˜åˆ¶ä¹‹å‰ï¼ˆé€šå¸¸åœ¨ 16.66ms å†…ï¼‰  |
| å›è°ƒå‚æ•°       | æä¾›ç©ºé—²æ—¶é—´å‰©ä½™ä¿¡æ¯ï¼ˆ`deadline.timeRemaining()`ï¼‰ | æä¾›æ—¶é—´æˆ³ï¼ˆé«˜ç²¾åº¦æ—¶é—´ï¼‰            |
| æ˜¯å¦ä¿è¯æ‰§è¡Œ     | âŒ å¯èƒ½è¢«è·³è¿‡æˆ–å»¶è¿Ÿ                             | âœ… å‡ ä¹æ¯å¸§éƒ½ä¼šè°ƒç”¨              |
| æ˜¯å¦å½±å“å¸§ç‡     | âŒ è‡ªåŠ¨é¿å…å½±å“å¸§ç‡                             | âœ… å¯èƒ½å½±å“å¸§ç‡ï¼ˆè‹¥è€—æ—¶è¿‡é•¿ï¼‰         |
| æ˜¯å¦é€‚åˆæ‰§è¡Œé‡ç»˜æ“ä½œ | âŒ ä¸é€‚åˆï¼ˆå¯èƒ½åœ¨æ¸²æŸ“ä¹‹åï¼‰                         | âœ… éå¸¸é€‚åˆï¼ˆä¸æ¸²æŸ“åŒæ­¥ï¼‰           |
| æµè§ˆå™¨æ”¯æŒ      | è¾ƒå·®ï¼ˆéœ€é™çº§å¤„ç†ï¼‰                              | å¹¿æ³›æ”¯æŒ                    |
| å¯ä¸­æ–­æ€§       | âœ… å¯åˆ¤æ–­å‰©ä½™æ—¶é—´å¹¶ä¸­æ–­                           | âŒ ä¸å…·å¤‡ä¸­æ–­èƒ½åŠ›               |

## ğŸ§ª ä½¿ç”¨ç¤ºä¾‹

requestIdleCallback ç¤ºä¾‹

```javascript
requestIdleCallback((deadline) => {
  // âœ… deadline.timeRemaining() è¡¨ç¤ºå½“å‰å¸§è¿˜å‰©å¤šå°‘æ¯«ç§’å¯ä»¥ç”¨ã€‚
  while (deadline.timeRemaining() > 0 && tasks.length > 0) {
    doWork(tasks.shift());
  }
});
```

requestAnimationFrame ç¤ºä¾‹

```javascript
function animate() {
  updateElementPosition();
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);
```

## ğŸ§­ åº”ç”¨åœºæ™¯å»ºè®®

| åœºæ™¯            | å»ºè®®ä½¿ç”¨                                         |
| ------------- | -------------------------------------------- |
| é¡µé¢åŠ¨ç”»ã€ä½ç§»å˜æ¢ç­‰    | `requestAnimationFrame`                      |
| ä¸å½±å“ç”¨æˆ·ä½“éªŒçš„éå…³é”®é€»è¾‘ | `requestIdleCallback`                        |
| è™šæ‹Ÿåˆ—è¡¨æƒ°æ€§åŠ è½½      | `requestIdleCallback` + `timeRemaining` åˆ†ç‰‡æ‰§è¡Œ |
| åŠ¨ç”»å¸§åŒæ­¥çš„æ¸¸æˆé€»è¾‘    | `requestAnimationFrame`                      |
