# Agent

## ä¸€ã€Agent æ˜¯ä»€ä¹ˆ

> Agent = èƒ½è‡ªä¸»è§„åˆ’ã€å¤šæ­¥å†³ç­–ã€è°ƒç”¨å·¥å…·ã€åŸºäºåé¦ˆä¿®æ­£è¡Œä¸ºçš„ LLM é©±åŠ¨ç³»ç»Ÿ

å…³é”®ä¸åœ¨â€œä¼šä¸ä¼šç”Ÿæˆâ€ï¼Œè€Œåœ¨ï¼š

- æ˜¯å¦ è‡ªå·±å†³å®šä¸‹ä¸€æ­¥
- æ˜¯å¦ ä¼šç”¨å·¥å…·
- æ˜¯å¦ çŸ¥é“ä»€ä¹ˆæ—¶å€™åœ

## äºŒã€ä¸ºä»€ä¹ˆ LLM â‰  Agentï¼ˆå¿…é¡»å…ˆåˆ’æ¸…ï¼‰

| èƒ½åŠ›     | LLM   | Agent |
| ------ | ----- | ----- |
| è‡ªç„¶è¯­è¨€ç†è§£ | âœ…     | âœ…     |
| ä¸€æ¬¡æ€§å›ç­”  | âœ…     | âœ…     |
| å¤šæ­¥ä»»åŠ¡   | âŒ     | âœ…     |
| å·¥å…·è°ƒç”¨   | âŒï¼ˆè¢«åŠ¨ï¼‰ | âœ…ï¼ˆä¸»åŠ¨ï¼‰ |
| çŠ¶æ€è®°å¿†   | âŒ     | âœ…     |
| å¤±è´¥é‡è¯•   | âŒ     | âœ…     |

> ğŸ‘‰ LLM æ˜¯â€œå¤§è„‘â€ï¼ŒAgent æ˜¯â€œå¸¦æ‰‹å’Œè®°å¿†çš„å¤§è„‘â€

## ä¸‰ã€Agent çš„æœ€å°æ„æˆï¼ˆéå¸¸é‡è¦ï¼‰

ä¸€ä¸ª Agentï¼Œæœ€å°‘åªéœ€è¦ 4 ä¸ªæ¨¡å—ï¼š

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM    â”‚  â† æ¨ç† & å†³ç­–
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ Planner  â”‚  â† ä»»åŠ¡æ‹†è§£
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ Executor â”‚  â† è°ƒç”¨å·¥å…·
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚  Memory  â”‚  â† çŠ¶æ€ / å†å²
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> æ²¡æœ‰ Planner çš„ä¸å« Agentï¼Œåªæ˜¯ Tool Calling

## å››ã€Agent çš„å·¥ä½œå¾ªç¯ï¼ˆæ ¸å¿ƒï¼‰

ç»å…¸ Agent Loopï¼š

```txt
while (!done) {
  thought = LLM.think(state)
  action  = Planner.decide(thought)
  result  = Executor.run(action)
  Memory.update(result)
}
```

å¯ä»¥ç†è§£ä¸ºï¼š

> â€œæƒ³ â†’ é€‰ â†’ åš â†’ è®° â†’ å†æƒ³â€

## äº”ã€Plannerï¼ˆAgent çš„çµé­‚ï¼‰

Planner å†³å®šï¼š

- ç”¨ä¸ç”¨å·¥å…·
- ç”¨å“ªä¸ªå·¥å…·
- é¡ºåºæ€ä¹ˆæ’

å¸¸è§ Planner ç±»å‹

| Planner     | ç‰¹ç‚¹    |
| ----------- | ----- |
| Rule-based  | å¯æ§ã€æ­»æ¿ |
| LLM Planner | çµæ´»ã€æ™ºèƒ½ |
| Hybrid      | å·¥ç¨‹å¸¸ç”¨  |

ç¤ºä¾‹ï¼ˆå·¥ç¨‹åŒ–ï¼‰

```json
{
  "step": 1,
  "tool": "analyze_project",
  "reason": "éœ€è¦ä¾èµ–å›¾æ¥åˆ¤æ–­å½±å“èŒƒå›´"
}
```

## å…­ã€Executorï¼ˆè½åœ°å±‚ï¼‰

Executor çš„èŒè´£å¾ˆç®€å•ï¼š

> æŠŠ Agent çš„â€œæ„å›¾â€ç¿»è¯‘æˆ MCP Tool Call

```ts
const result = await ctx.rpc.call(toolName, params)
```

ğŸ“Œ Executor ä¸åšå†³ç­–ï¼Œåªåšæ‰§è¡Œ

## ä¸ƒã€Memoryï¼ˆè®© Agent çœŸæ­£â€œæ´»ç€â€ï¼‰

Memory ç±»å‹

| ç±»å‹         | è¯´æ˜        |
| ---------- | --------- |
| Short-term | å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡   |
| Long-term  | å†å²ç»éªŒ / åå¥½ |
| Working    | ä¸­é—´ç»“æœ      |

åœ¨ IDE åœºæ™¯ä¸­ï¼š

- å½“å‰æ‰“å¼€æ–‡ä»¶
- æœ€è¿‘è°ƒç”¨çš„å·¥å…·
- ä¸Šä¸€æ­¥ DAG ç»“æœ

> ğŸ‘‰ è¿™äº›éƒ½æ˜¯ Memoryï¼Œè€Œä¸æ˜¯ Prompt

## å…«ã€Agent Ã— MCP Ã— RAG

å„è‡ªåˆ†å·¥

| æ¨¡å—    | è§’è‰²        |
| ----- | --------- |
| Agent | å†³ç­–è€…       |
| MCP   | å·¥å…· / èµ„æºåè®® |
| RAG   | çŸ¥è¯†å¢å¼º      |

ååŒæµç¨‹

```txt
User
 â†“
Agentï¼ˆæ‹†ä»»åŠ¡ï¼‰
 â†“
MCP Toolï¼ˆæ£€ç´¢ / åˆ†æï¼‰
 â†“
RAGï¼ˆä¸Šä¸‹æ–‡å¢å¼ºï¼‰
 â†“
LLMï¼ˆç”Ÿæˆï¼‰
```

> ğŸ‘‰ Agent å†³å®šâ€œæŸ¥ä¸æŸ¥â€ï¼ŒRAG è´Ÿè´£â€œæ€ä¹ˆæŸ¥â€

## ä¹ã€Agent åœ¨ Code / IDE åœºæ™¯çš„å…¸å‹èƒ½åŠ›

ç»“åˆä½ ç°åœ¨çš„æ–¹å‘ï¼š

### 1ï¸âƒ£ ä»£ç ç†è§£ Agent

- è‡ªåŠ¨è°ƒç”¨ï¼š
  - analyze_project
  - read_file
- è¾“å‡ºï¼š
  - ä¾èµ–é“¾
  - è°ƒç”¨è·¯å¾„
  - å½±å“é¢

### 2ï¸âƒ£ Refactor Agent

```txt
1. åˆ†æè°ƒç”¨å…³ç³»
2. æ‰¾åˆ°ä¿®æ”¹ç‚¹
3. æ‰¹é‡ä¿®æ”¹
4. éªŒè¯å½±å“
```

### 3ï¸âƒ£ Debug Agent

- è¯»å–é”™è¯¯æ—¥å¿—
- å®šä½ç›¸å…³ä»£ç 
- æ²¿ DAG å›æº¯
- ç»™å‡ºä¿®å¤å»ºè®®

## åã€å¸¸è§ Agent åæ¨¡å¼ï¼ˆè¸©å‘é¢„è­¦ï¼‰

- âŒ æ‰€æœ‰ä¿¡æ¯éƒ½å¡è¿› Prompt
- âŒ æ¯ä¸€æ­¥éƒ½è®©äººç‚¹ç¡®è®¤
- âŒ Agent ç›´æ¥æ“ä½œ DB / FileSystemï¼ˆæ—  MCPï¼‰
- âŒ æ²¡æœ‰ Stop Conditionï¼ˆæ­»å¾ªç¯ï¼‰

## åä¸€ã€ä¸€ä¸ªâ€œå·¥ç¨‹çº§ Agentâ€æœ€å°ç¤ºä¾‹ï¼ˆä¼ªä»£ç ï¼‰

```ts
class CodeAgent {
  async run(question) {
    while (!this.done) {
      const plan = await this.llm.plan(this.state)

      if (plan.tool) {
        const result = await this.executor.call(plan.tool)
        this.memory.save(result)
      } else {
        return await this.llm.answer(this.memory)
      }
    }
  }
}
```
