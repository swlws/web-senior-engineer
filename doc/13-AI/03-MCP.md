# MCP

## ä¸€ã€MCP æ˜¯ä»€ä¹ˆ

> MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€å¥—â€œè®© LLM å®‰å…¨ã€ç»“æ„åŒ–åœ°ä½¿ç”¨å¤–éƒ¨ä¸Šä¸‹æ–‡ä¸å·¥å…·â€çš„åè®®è§„èŒƒ

å®ƒè§£å†³çš„ä¸æ˜¯â€œæ¨¡å‹æ€ä¹ˆæ¨ç†â€ï¼Œè€Œæ˜¯ï¼š

> æ¨¡å‹å¦‚ä½•ã€Œè¢«å…è®¸ã€è¢«çº¦æŸã€è¢«æ ‡å‡†åŒ–ã€åœ°æ¥å…¥å¤–éƒ¨èƒ½åŠ›

MCP çš„æ ¸å¿ƒå®šä½

| ç»´åº¦   | MCP                            |
| ---- | ------------------------------ |
| é¢å‘å¯¹è±¡ | LLM                            |
| è§£å†³é—®é¢˜ | Context / Tool / Resource çš„æ ‡å‡†åŒ– |
| æœ¬è´¨   | **LLM ä¸å¤–éƒ¨ä¸–ç•Œçš„â€œä¸­é—´åè®®å±‚â€**          |
| ç±»æ¯”   | HTTP ä¹‹äºæµè§ˆå™¨ & æœåŠ¡ç«¯               |

## äºŒã€ä¸ºä»€ä¹ˆä¼šæœ‰ MCP

âŒ ä¼ ç»Ÿ LLM å·¥å…·è°ƒç”¨çš„é—®é¢˜

| é—®é¢˜       | è¯´æ˜                     |
| -------- | ---------------------- |
| å¼ºè€¦åˆ      | Tool schema å†™æ­»åœ¨ Prompt |
| ä¸å¯å‘ç°     | æ¨¡å‹ä¸çŸ¥é“ç³»ç»Ÿæœ‰å“ªäº›èƒ½åŠ›           |
| ä¸å¯æ‰©å±•     | æ–°èƒ½åŠ› = æ”¹ Prompt         |
| æ— æ³•å¤ç”¨     | ä¸åŒ Agent é‡å¤é€ è½®å­         |
| IDE é›†æˆå›°éš¾ | æ²¡æœ‰æ ‡å‡†äº¤äº’å±‚                |

> ğŸ‘‰ MCP çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³ â€œLLM å¦‚ä½•åƒç¨‹åºä¸€æ ·ä½¿ç”¨å·¥å…·â€ è¿™ä¸ªé—®é¢˜ã€‚

## ä¸‰ã€MCP çš„æ ¸å¿ƒæ€æƒ³ï¼ˆéå¸¸é‡è¦ï¼‰

MCP åªå®šä¹‰ä¸‰ç±»ä¸œè¥¿ï¼š

- Resourcesï¼ˆèµ„æºï¼‰
- Toolsï¼ˆå·¥å…·ï¼‰
- Promptsï¼ˆæç¤ºæ¨¡æ¿ï¼‰

### 1ï¸âƒ£ Tool æ˜¯â€œèƒ½åŠ›â€ï¼Œä¸æ˜¯å‡½æ•°

MCP æŠŠå·¥å…·æŠ½è±¡æˆï¼š

```txt
èƒ½åŠ›ï¼ˆCapabilityï¼‰ = åå­— + è¾“å…¥ schema + è¾“å‡º schema + æè¿°
```

è€Œä¸æ˜¯ï¼š

```ts
function foo(a, b) {}
```

### 2ï¸âƒ£ Prompts æ˜¯ç»“æ„åŒ–çš„ï¼Œä¸æ˜¯çº¯æ–‡æœ¬

ä¸æ˜¯ï¼š

```txt
è¿™æ˜¯é¡¹ç›®ç»“æ„...
è¿™æ˜¯æ–‡ä»¶å†…å®¹...
è¿™æ˜¯ä¾èµ–å…³ç³»...
```

è€Œæ˜¯ï¼š

```json
{
  "type": "code",
  "language": "ts",
  "path": "...",
  "content": "..."
}
```

ğŸ‘‰ è¿™æ˜¯ MCP èƒ½å·¥ç¨‹åŒ–è½åœ°çš„å…³é”®ã€‚

## å››ã€MCP çš„æ•´ä½“æ¶æ„

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     LLM     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ MCP Call
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MCP Client  â”‚  â† Agent / IDE / App
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ JSON-RPC
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MCP Server  â”‚  â† èƒ½åŠ›æä¾›è€…
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tools / API â”‚  â† æ–‡ä»¶ç³»ç»Ÿ / Git / DB
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## äº”ã€MCP åè®®æ ¸å¿ƒç»„æˆ

### 1ï¸âƒ£ Tool å®šä¹‰ï¼ˆèƒ½åŠ›å£°æ˜ï¼‰

```json
{
  "name": "analyze_project",
  "description": "åˆ†æå‰ç«¯å·¥ç¨‹ç»“æ„",
  "inputSchema": {
    "type": "object",
    "properties": {
      "root": { "type": "string" }
    }
  }
}
```

> æ¨¡å‹ `å…ˆçŸ¥é“â€œæœ‰ä»€ä¹ˆèƒ½åŠ›â€`ï¼Œå†å†³å®šç”¨ä¸ç”¨ã€‚

### 2ï¸âƒ£ Tool è°ƒç”¨ï¼ˆç»“æ„åŒ– RPCï¼‰

```json
{
  "method": "analyze_project",
  "params": {
    "root": "/project"
  }
}
```

> ğŸ‘‰ ä¸æ˜¯è‡ªç„¶è¯­è¨€ï¼Œè€Œæ˜¯ç¡®å®šæ€§è°ƒç”¨

### 3ï¸âƒ£ Tool è¿”å›ï¼ˆContext ç”Ÿæˆï¼‰

```json
{
  "type": "dag",
  "nodes": [...],
  "edges": [...]
}
```

> è¿™ä¸€æ­¥ï¼Œç›´æ¥ä¸º RAG / Graph / å¯è§†åŒ–æœåŠ¡ã€‚

## å…­ã€MCP vs Function Callingï¼ˆæœ¬è´¨åŒºåˆ«ï¼‰

MCP åŸºäºä»€ä¹ˆï¼Ÿ

- JSON-RPC 2.0
- stdio / HTTP / WebSocket

| å¯¹æ¯”é¡¹    | Function Calling | MCP   |
| ------ | ---------------- | ----- |
| æ ‡å‡†åŒ–    | âŒ ç§æœ‰             | âœ… åè®®çº§ |
| èƒ½åŠ›å‘ç°   | âŒ                | âœ…     |
| å¤šå·¥å…·    | âŒ å¼±              | âœ…     |
| IDE æ”¯æŒ | âŒ                | âœ…     |
| å¯ç»„åˆ    | âŒ                | âœ…     |
| ä¸Šä¸‹æ–‡ç»“æ„  | âŒ                | âœ…     |

> ğŸ‘‰ MCP æ˜¯ â€œå·¥ä¸šçº§ Tool Callingâ€ã€‚

## ä¸ƒã€MCP å’Œ Agent çš„å…³ç³»ï¼ˆå¾ˆå¤šäººæ··æ·†ï¼‰

> ç»“è®ºå…ˆè¡Œ: Agent â‰  MCPï¼ŒAgent ä½¿ç”¨ MCP

### è§’è‰²æ‹†åˆ†

| è§’è‰²    | èŒè´£             |
| ----- | -------------- |
| Agent | å†³ç­–ï¼šç”¨ä¸ç”¨ã€ç”¨å“ªä¸ªã€ç”¨å‡ æ¬¡ |
| MCP   | æ‰§è¡Œï¼šèƒ½åŠ›å‘ç° + è°ƒç”¨   |
| Tool  | å¹²æ´»ï¼šæŸ¥ä»£ç ã€ç®—ä¾èµ–     |

### ä¸€ä¸ªçœŸå® Agent æ‰§è¡Œæµ

```txt
ç”¨æˆ·é—®é¢˜
 â†“
Agent åˆ¤æ–­ï¼šéœ€è¦é¡¹ç›®ç»“æ„
 â†“
é€šè¿‡ MCP è°ƒç”¨ analyze_project
 â†“
è¿”å› DAG
 â†“
Agent å†å†³å®šï¼šæ˜¯å¦éœ€è¦è¯»æ–‡ä»¶
 â†“
æœ€ç»ˆæ€»ç»“
```

## å…«ã€MCP å’Œ RAG çš„å…³ç³»ï¼ˆå…³é”®ç‚¹ï¼‰

> MCP æ˜¯ RAG çš„â€œæ•°æ®ç”Ÿäº§ç®¡é“â€

| RAG é˜¶æ®µ | MCP çš„ä½œç”¨          |
| ------ | ---------------- |
| æ•°æ®è·å–   | Tool ç›´æ¥äº§å‡º        |
| æ•°æ®ç»“æ„   | JSON / DAG / AST |
| åŠ¨æ€ä¸Šä¸‹æ–‡  | æŒ‰éœ€ç”Ÿæˆ             |
| å®æ—¶æ€§    | å³æ—¶è®¡ç®—             |

ä¸¾ä¾‹

```txt
LLM:
  â†’ è°ƒç”¨ tool: search_code
MCP:
  â†’ å‘é‡æ£€ç´¢
  â†’ è¿”å› chunks ä½œä¸º resource
LLM:
  â†’ åŸºäº resource å›ç­”
```

## ä¹ã€MCP åœ¨ IDEï¼ˆVSCodeï¼‰ä¸­çš„ä»·å€¼

æ²¡æœ‰ MCP

- æ’ä»¶å†™æ­»é€»è¾‘
- éš¾ä»¥æ¥ LLM
- åŠŸèƒ½ç¢ç‰‡åŒ–

æœ‰ MCP

```txt
VSCode
 â†“
MCP Client
 â†“
frontend-mcp-server
 â†“
è§£æé¡¹ç›® / ç”Ÿæˆ DAG
 â†“
LLM è§£é‡Š / å¯è§†åŒ–
```

- VSCode æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ
  - MCP Client
  - æä¾› UI
  - è½¬å‘ Tool è°ƒç”¨
  - å±•ç¤º Resource
- èƒ½åŠ›ç¤ºä¾‹
  - é€‰ä¸­ä»£ç  â†’ MCP â†’ ç»“æ„åˆ†æ
  - ä¾èµ–å›¾ â†’ MCP â†’ DAG â†’ G6
  - Chat â†’ MCP â†’ Code RAG

> ğŸ‘‰ IDE åªè´Ÿè´£ UIï¼Œèƒ½åŠ›å…¨éƒ¨åç§»

## åã€ä¸€ä¸ªæç®€ MCP Server ç¤ºä¾‹ï¼ˆNode.jsï¼‰

```ts
import { Server } from '@modelcontextprotocol/sdk/server';

const server = new Server();

server.tool({
  name: 'analyze_project',
  description: 'åˆ†æå‰ç«¯å·¥ç¨‹ä¾èµ–',
  inputSchema: {
    type: 'object',
    properties: {
      root: { type: 'string' }
    }
  },
  async handler({ root }) {
    return analyzeProject(root); // è¿”å› DAG
  }
});

server.start();
```

## åä¸€ã€MCP çš„å…¸å‹èƒ½åŠ›åˆ†ç±»ï¼ˆå®æˆ˜ï¼‰

| ç±»å‹  | ç¤ºä¾‹                         |
| --- | -------------------------- |
| æ–‡ä»¶  | read_file / search         |
| ä»£ç   | analyze_ast / find_refs    |
| å·¥ç¨‹  | analyze_deps / build_graph |
| Git | diff / blame               |
| æ–‡æ¡£  | generate_markdown          |
| å¯è§†åŒ– | graph / g6                 |

## æ€»ç»“ä¸€å¥è¯

MCP æ˜¯æŠŠâ€œAI èƒ½åŠ›â€å·¥ç¨‹åŒ–ã€åè®®åŒ–ã€å¹³å°åŒ–çš„å…³é”®åŸºç¡€è®¾æ–½
