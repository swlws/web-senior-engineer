# 现代浏览器架构设计

现代浏览器架构设计（如 Chrome、Edge、Firefox）已经进化为一个高度模块化、多进程、安全隔离的系统，远远超出了“渲染 HTML”的简单任务。它不仅要加载页面，还要处理性能、安全、并发、隐私、离线能力等复杂问题。

## 🧩 一、现代浏览器的整体架构

```text
┌─────────────────────────────────────┐
│        用户界面层（UI Process）      │
├─────────────────────────────────────┤
│        浏览器主进程（Browser Process）│
├─────────────────────────────────────┤
│   网络进程（Network Process）        │
├─────────────────────────────────────┤
│ 渲染进程（Renderer Process，多个） │
├─────────────────────────────────────┤
│ 插件进程（Plugin Process）          │
├─────────────────────────────────────┤
│ GPU 进程（GPU Process）             │
└─────────────────────────────────────┘
```

## 🔧 二、主要模块详解

### 1. 浏览器主进程（Browser Process）

- 负责：管理所有页面、窗口、标签
- 控制网络进程、渲染进程等子进程的生命周期
- 处理用户界面逻辑（地址栏、前进后退、书签等）
- 安全沙箱：限制子进程权限

### 2. 渲染进程（Renderer Process）

- 每个标签页或 iframe 通常有单独的渲染进程
- 执行：
  - HTML 解析、DOM 构建
  - CSS 样式计算
  - JavaScript 执行（由 JS 引擎，如 V8）
  - 布局、分层、合成、绘制
- 默认运行在沙箱中，保护用户系统安全

> ✅ 每个进程彼此隔离，防止页面崩溃互相影响（比如某个标签卡死不会影响整个浏览器）

### 3. 网络进程（Network Process）

- 独立处理所有 HTTP/HTTPS 请求、缓存、Cookie、Service Worker 等网络相关逻辑
- 提供跨标签共享的网络连接
- 在现代架构中，常从渲染进程中剥离出来，提升安全性和复用性

### 4. GPU 进程（GPU Process）

- 处理页面的硬件加速绘制：如 3D 渲染、视频播放、图形合成
- Chrome 在布局和合成阶段大量依赖 GPU 加速，提高渲染性能

### 5. 插件进程（Plugin Process）

- 主要用于运行独立的浏览器插件（如 Flash，已淘汰）
- 也用于封装 PDF、视频播放器等

## 🧠 三、关键设计理念

### ✅ 多进程架构

- 每个标签页/站点可独立运行在不同进程
- 提高稳定性（防止崩溃蔓延）
- 提高安全性（进程沙箱）
- 提高并发性（渲染可多核并行）

### ✅ Site Isolation（站点隔离）

- Chrome 强化的安全策略（尤其针对 Spectre 攻击）
- 不同 origin 的页面将使用不同渲染进程
- 跨站点 iframe 也会被隔离

### ✅ Renderer Pipeline（渲染管线）

一个典型渲染过程包括：

```text
HTML 解析 → DOM 构建
CSS 解析 → Style 计算
→ Layout（布局）
→ Layer 分层
→ Paint（绘制指令）
→ Compositing（合成层） → GPU 绘制
```

这些操作由渲染进程完成，但部分（如合成）由 GPU 进程协助执行。

## 📦 四、浏览器架构演进（Chrome 举例）

| 阶段                  | 架构变化                   |
| ------------------- | ---------------------- |
| 初期（2008）            | 每个标签页一个进程              |
| 后期                  | 渲染进程和网络进程分离            |
| 现代                  | 完善站点隔离、拆分子线程、启用 GPU 进程 |
| 未来（Project Fission） | 每个 iframe 独立进程，进一步极致隔离 |

## 🔐 五、安全机制集成

- 沙箱（Sandbox）：限制渲染进程权限
- Same-Origin Policy：阻止跨站脚本攻击
- Site Isolation：进程级别的域隔离
- CSP（内容安全策略）
- HTTPS-only 模式

## 🔍 六、总结图示（简化）

```text
用户点击页面
    ↓
Browser Process （协调）
    ↓
Network Process ←→ 网络资源
    ↓
Renderer Process（渲染、JS）
    ↓
GPU Process（合成与加速绘制）
```

## 📘 相关工具推荐

- DevTools → Performance、Rendering 面板分析渲染流程
- chrome://process-internals/ 查看进程详情
- chrome://tracing 查看渲染轨迹
