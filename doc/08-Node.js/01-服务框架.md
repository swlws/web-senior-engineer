# Node.js 服务框架

主流 Web 框架：Express、Koa、NestJS、Restify 四者在开发体验、应用场景、设计理念等方面的差异。

## ✅ 四大框架对比总览

| 特性          | **Express**              | **Koa**                           | **NestJS**                                | **Restify**               |
| ------------- | ------------------------ | --------------------------------- | ----------------------------------------- | ------------------------- |
| 🌐 定位       | Web 应用和 REST API      | 轻量中间件框架                    | 企业级框架，TS 强依赖，模块化架构         | 专注 REST API，高性能轻量 |
| 📦 生态       | 非常丰富（中间件最多）   | 较丰富（许多中间件兼容 Express）  | 丰富（官方/社区模块多）                   | 插件少，官方组件为主      |
| 🧠 架构风格   | 基于函数堆叠的中间件模型 | 洋葱模型 async/await              | OOP + DI + 模块系统                       | 基于 handler 的轻量架构   |
| 🧪 类型支持   | JS 优先，TS 支持不强     | JS/TS 都支持                      | 强制使用 TypeScript                       | JS/TS 都支持              |
| 🚀 性能       | 中等                     | 更高（更轻，async 原生支持）      | 中等偏下（框架开销大）                    | 高（专注性能优化）        |
| 🧱 工程结构   | 无强制结构，自由组织     | 无强制结构，自由度高              | 强制模块化、清晰结构                      | 无强制结构，自由          |
| 📚 学习曲线   | 低，易上手               | 中（需理解 async/await/洋葱模型） | 高（OOP、装饰器、DI、模块体系）           | 低，API 简单              |
| 🎯 应用规模   | 中小型项目               | 中型项目（灵活性强）              | 中大型项目、团队协作系统                  | 简单轻量服务、边缘服务    |
| 🔧 微服务支持 | 手动实现                 | 灵活实现                          | 内置支持 Kafka/gRPC/MQ 等微服务通信方式   | 不适合微服务              |
| 🧩 内置功能   | 路由、中间件基本支持     | 没有，需引入 koa-router 等        | 丰富（Swagger、验证、缓存、拦截器等全套） | 简单 REST 构建，功能较少  |

## 🧩 使用体验对比（开发角度）

| 使用体验项 | Express              | Koa                     | NestJS                  | Restify            |
| ---------- | -------------------- | ----------------------- | ----------------------- | ------------------ |
| 中间件机制 | next() 级联          | 洋葱模型                | 拦截器 + 生命周期钩子   | handler 串联       |
| 异步支持   | 支持 Promise，但繁琐 | 原生 async/await        | 原生 async/await        | 支持 async/Promise |
| 路由机制   | 内置 router          | 需使用 `koa-router`     | 使用装饰器定义（@Get）  | 路由方式灵活       |
| 请求解析   | 需引入 `body-parser` | 需引入 `koa-bodyparser` | 内置 `@Body()` 等装饰器 | 内置解析           |
| 类型推导   | 一般                 | 一般                    | 强类型，自动推导        | 弱类型，需手动补全 |
| 文档生成   | 手写 Swagger 或插件  | 手动集成                | 内置 Swagger 支持       | 手动集成           |
| 测试友好性 | 中等                 | 中等                    | 强（依赖注入利于 mock） | 中等               |

## 🎯 使用建议（按团队/项目规模）

| 项目 / 团队情况                              | 推荐框架          | 理由                                   |
| -------------------------------------------- | ----------------- | -------------------------------------- |
| 初学者、快速搭建原型                         | **Express**       | 社区文档丰富，教程多，简单直接         |
| 精通 async/await，喜欢中间件机制             | **Koa**           | 控制粒度高，性能优，写起来优雅         |
| TS 团队，有企业级需求、多人协作              | **NestJS**        | 工程化能力强，模块清晰，长期可维护性好 |
| 内部接口服务、网关、BFF、低延迟服务          | **Restify**       | 轻量快速，API 风格清晰，性能好         |
| 需要复杂路由 + 中间件 + 灵活组合             | **Express / Koa** | Koa 更现代；Express 生态大，开发门槛低 |
| 需要企业标准化开发框架（如类似 Java Spring） | **NestJS**        | DI、模块、守卫、拦截器齐全             |

## 🚀 性能对比（单位请求耗时）

> 以下为社区基准测试参考，仅供参考，真实表现受业务逻辑和部署环境影响：

| 框架        | 每秒请求数（RPS） | 相对性能   |
| ----------- | ----------------- | ---------- |
| **Restify** | 🚀 40,000+        | ⭐⭐⭐⭐⭐ |
| **Koa**     | 🚀 35,000+        | ⭐⭐⭐⭐   |
| **Express** | 🚀 30,000+        | ⭐⭐⭐     |
| **NestJS**  | 🚀 20,000+        | ⭐⭐       |

NestJS 因为封装多、功能重，性能相对略低，但其结构化优势远高于性能损失。

## ✅ 总结（一句话推荐）

- Express：最通用的 Node 框架，文档全、生态大，适合快速开发。
- Koa：下一代中间件框架，灵活、性能高，适合中型服务自定义控制。
- NestJS：企业级项目首选，强类型、模块化、微服务支持好，适合复杂项目。
- Restify：专为 REST API 设计，轻量高性能，适合资源敏感型服务。
