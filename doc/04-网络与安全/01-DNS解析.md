# DNS 解析

DNS（Domain Name System）解析是将**域名（如 www.example.com）转换为 IP 地址（如 93.184.216.34）**的过程，本质是为了让人类可读的地址可以转化为机器可识别的网络地址。

## 🧠 一、DNS 解析过程概览

以访问 www.example.com 为例：

```text
浏览器输入网址 → 查找 IP 地址 → 建立连接 → 请求资源
```

DNS 查询主要分为 5 步：

1. 浏览器缓存
   浏览器会先查本地缓存中是否有 www.example.com 的解析记录。
2. 操作系统缓存（本地 hosts 文件）
   如果浏览器缓存没有，会查 OS 的缓存，或 C:\Windows\System32\drivers\etc\hosts 文件。
3. 本地域名解析器（DNS Resolver）
   向系统配置的本地 DNS 服务器发起请求，通常由运营商提供。
4. 递归查询（非权威 DNS 服务器）
   - 本地 DNS 若没有，会递归查询：
     - 根域名服务器（.）
     - 顶级域名服务器（.com）
     - 权威域名服务器（example.com）
5. 返回结果 & 缓存
   最终获得 IP 地址后，逐层返回、缓存，供下次使用。

## 🔄 二、DNS 查询方式

| 查询方式         | 说明                                                        |
| ---------------- | ----------------------------------------------------------- |
| **递归查询**     | 客户端要求 DNS 服务器必须给出最终答案                       |
| **迭代查询**     | DNS 服务器只告诉客户端“下一步该找谁”                        |
| 实际中常见的模式 | **客户端对本地 DNS 是递归查询，DNS 对上级服务器是迭代查询** |

## 🌍 三、常见的 DNS 服务器

| 类型         | 示例                                         |
| ------------ | -------------------------------------------- |
| 根服务器     | 全球仅有 13 个（A\~M 根服务器）              |
| 顶级域服务器 | 例如负责 .com 的 TLD 服务器                  |
| 权威 DNS     | 最终返回目标域名的 IP 地址                   |
| 公共 DNS     | Google DNS（8.8.8.8），Cloudflare（1.1.1.1） |

## 🛡️ 四、DNS 相关问题与优化

### 1. 性能优化

- DNS 预解析（DNS Prefetch）

```html
<link rel="dns-prefetch" href="//example.com" />
```

- 缓存优化
  - DNS 记录有 TTL（Time to Live）字段，控制缓存时长。
  - CDN 也会缓存解析结果以加速。

### 安全问题

- DNS 劫持：运营商或中间人篡改返回结果。
- DNS 污染：网络出口污染 DNS 数据（如部分地区封锁特定域名）。
- 解决方式：
  - 使用加密协议如 DNS over HTTPS（DoH） 或 DNS over TLS（DoT）
  - 使用可信 DNS，如 Cloudflare（1.1.1.1）、Google DNS（8.8.8.8）

## 🧪 五、实用工具与命令

| 工具/命令                           | 作用                           |
| ----------------------------------- | ------------------------------ |
| `ping example.com`                  | 查看是否能解析和连接           |
| `nslookup example.com`              | 获取 DNS 解析详情              |
| `dig example.com`                   | 高级 DNS 诊断工具（Linux/mac） |
| 浏览器 DevTools > Network > Headers | 查看请求是否命中 DNS 缓存      |

## ✅ 常见面试题总结

- DNS 解析过程？
- DNS 劫持与防护？
- TTL 是什么？对性能有何影响？
- 浏览器是怎么从域名拿到 IP 的？各个缓存阶段？
- 如何减少 DNS 查询次数？
- 如何做 DNS 预解析？
