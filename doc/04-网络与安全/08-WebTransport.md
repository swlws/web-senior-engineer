# WebTransport

WebTransport â€”â€”å®ƒæ˜¯æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„ä¸€ç§æ–°å‹ åŸºäº UDP çš„ä½å»¶è¿ŸåŒå‘é€šä¿¡åè®®ï¼Œæ˜¯ WebSocketã€WebRTC çš„æ½œåœ¨æ›¿ä»£æ–¹æ¡ˆã€‚

## ğŸ“Œ ä¸€ã€WebTransport æ˜¯ä»€ä¹ˆï¼Ÿ

WebTransport æ˜¯ä¸€ç§æµè§ˆå™¨æä¾›çš„ APIï¼Œç”¨äºé€šè¿‡ HTTP/3ï¼ˆQUICï¼Œåº•å±‚ä¸º UDPï¼‰ å®ç° ä½å»¶è¿Ÿã€å¯é æˆ–ä¸å¯é çš„åŒå‘é€šä¿¡ã€‚

### âœ… ç›¸æ¯” WebSocket çš„ä¼˜åŠ¿ï¼š

| åŠŸèƒ½           | WebSocket | WebTransport             |
| -------------- | --------- | ------------------------ |
| ä¼ è¾“åè®®       | TCP       | **UDP (QUIC)**           |
| å¤šæµå¤ç”¨       | âŒ        | âœ…ï¼ˆå¯å¹¶å‘å¤šä¸ªæµï¼‰       |
| å•å‘æµæ”¯æŒ     | âŒ        | âœ…                       |
| ä¸å¯é æ•°æ®é€šé“ | âŒ        | âœ…ï¼ˆèŠ‚çœå¼€é”€ï¼Œé€‚åˆå®æ—¶ï¼‰ |
| å¤´éƒ¨å‹ç¼©ä¼˜åŒ–   | âŒ        | âœ…ï¼ˆHTTP/3ï¼‰             |
| é€‚åˆå¤§è§„æ¨¡å¹¶å‘ | ä¸€èˆ¬      | æ›´ä¼˜                     |

> âœ… å¯ä»¥ç†è§£ä¸ºï¼šWebTransport = WebSocket + WebRTC çš„ç»¼åˆå‡çº§ç‰ˆæœ¬

## ğŸŒ äºŒã€æµè§ˆå™¨æ”¯æŒæƒ…å†µï¼ˆ2025ï¼‰

| æµè§ˆå™¨        | æ”¯æŒæƒ…å†µ                      |
| ------------- | ----------------------------- |
| âœ… Chrome 91+ | å®Œæ•´æ”¯æŒï¼ˆéœ€ HTTPS + HTTP/3ï¼‰ |
| âœ… Edge 91+   | æ”¯æŒ                          |
| âŒ Safari     | éƒ¨åˆ†å®éªŒæ”¯æŒï¼ˆéœ€è®¾ç½®ï¼‰        |
| âŒ Firefox    | å®éªŒæ€§æ”¯æŒä¸­ï¼Œé»˜è®¤å…³é—­        |

## âš ï¸ ä¸‰ã€ä½¿ç”¨å‰æ

- å¿…é¡»éƒ¨ç½²åœ¨ HTTPS + HTTP/3 (QUIC) ç¯å¢ƒä¸‹
- æœåŠ¡ç«¯å¿…é¡»æ”¯æŒ HTTP/3 + WebTransport

## ğŸ§ª å››ã€å®¢æˆ·ç«¯ä»£ç ç¤ºä¾‹ï¼ˆæµè§ˆå™¨ç«¯ï¼‰

```js
const transport = new WebTransport("https://your-server.com:4433/webtransport");

await transport.ready;
console.log("âœ… è¿æ¥å·²å»ºç«‹");

const stream = await transport.createBidirectionalStream();
const writer = stream.writable.getWriter();
const reader = stream.readable.getReader();

// å‘é€æ•°æ®
await writer.write(new TextEncoder().encode("hello from client"));
writer.releaseLock();

// è¯»å–æ•°æ®
const { value, done } = await reader.read();
if (!done) {
  console.log("ğŸ“¨ æ¥æ”¶æœåŠ¡ç«¯æ•°æ®:", new TextDecoder().decode(value));
}
```

## ğŸ§° äº”ã€æœåŠ¡ç«¯ç¤ºä¾‹ï¼ˆNode.js + [WebTransport over HTTP/3 å®ç°åº“](https://github.com/ietf-wg-webtrans/draft-ietf-webtrans-http3)ï¼‰

ç›®å‰ Node.js åŸç”Ÿæš‚æœªæ”¯æŒ WebTransport over HTTP/3ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å·¥å…·æ¥å®ç°æœåŠ¡ç«¯ï¼š

### âœ… æ¨èæ–¹æ¡ˆï¼š

1. ä½¿ç”¨ aioquic (Python)ï¼šæ”¯æŒ WebTransport åè®®
2. ä½¿ç”¨ Cloudflare Workersï¼ˆå·²åŸç”Ÿæ”¯æŒ WebTransportï¼‰
3. ä½¿ç”¨ Caddy æœåŠ¡å™¨ + QUIC æ’ä»¶ï¼ˆå®éªŒæ€§ï¼‰

## ğŸ’¬ ç¤ºä¾‹åœºæ™¯ï¼ˆé€‚åˆ WebTransport çš„åº”ç”¨ï¼‰

| åœºæ™¯                | æè¿°                     |
| ------------------- | ------------------------ |
| å®æ—¶æ¸¸æˆåŒæ­¥        | å°æ•°æ®åŒ…ã€ä½å»¶è¿Ÿã€é«˜å¹¶å‘ |
| å®æ—¶å­—å¹• / è¯­éŸ³     | ä¸å¯é ä¼ è¾“èŠ‚çœå¸¦å®½       |
| è§†é¢‘ç›´æ’­æ§åˆ¶ä¿¡ä»¤    | æ§åˆ¶é€šé“ vs è§†é¢‘é€šé“åˆ†ç¦» |
| æ›¿ä»£ WebSocket èŠå¤© | æ›´å¿«å»ºç«‹è¿æ¥ã€æ”¯æŒå¤šè·¯   |

## â— ä¸ WebRTC çš„å¯¹æ¯”

| ç‰¹æ€§         | WebRTC             | WebTransport         |
| ------------ | ------------------ | -------------------- |
| åº•å±‚         | UDP + STUN/ICE     | UDP + QUIC           |
| å¤æ‚åº¦       | é«˜ï¼ˆéœ€ä¿¡ä»¤ + ICEï¼‰ | ä½ï¼ˆçº¯ JS æ¥å£ï¼‰     |
| é€‚åˆéŸ³è§†é¢‘   | âœ…                 | âŒï¼ˆé€‚åˆæ§åˆ¶æˆ–æ•°æ®ï¼‰ |
| é€‚åˆæ•°æ®é€šä¿¡ | âœ…                 | âœ…                   |

## âœ… å…­ã€å®é™…éƒ¨ç½²å»ºè®®

| è¦ç‚¹                  | å»ºè®®                                          |
| --------------------- | --------------------------------------------- |
| æœåŠ¡ç«¯æ”¯æŒ QUIC/HTTP3 | ä½¿ç”¨ NGINXã€Caddyã€Cloudflare Workers         |
| HTTPS + HTTP/3 å¿…é¡»   | `Alt-Svc: h3=":443"` éœ€è®¾ç½®                   |
| æœ¬åœ°å¼€å‘              | å¯ä½¿ç”¨ `localhost:4433` + è‡ªç­¾è¯ä¹¦æ­é… Chrome |
| å®¢æˆ·ç«¯å…¼å®¹æ€§åˆ¤æ–­      | ä½¿ç”¨ `if ('WebTransport' in window) {}`       |

## ğŸ§© å°ç»“ï¼šä½•æ—¶ç”¨ WebTransportï¼Ÿ

| æƒ³è¦                             | å»ºè®®                                                  |
| -------------------------------- | ----------------------------------------------------- |
| æ›¿ä»£ WebSocketï¼Œæ”¯æŒå¤šæµã€ä½å»¶è¿Ÿ | âœ… WebTransport æ›´ä¼˜                                  |
| å®æ—¶éŸ³è§†é¢‘ï¼ˆP2Pï¼‰                | âŒ è¯·ç”¨ WebRTC                                        |
| ç®€å•åŒå‘æ•°æ®é€šä¿¡                 | WebSocket / WebTransport éƒ½å¯                         |
| ä¸å¯é æ•°æ®ã€å¯å®¹å¿ä¸¢åŒ…           | âœ… WebTransport æ”¯æŒ Unidirectional Stream / Datagram |
| æœåŠ¡ç«¯ä¸æ”¯æŒ HTTP/3              | âŒ éœ€ç­‰å¾…æˆ–åˆ‡æ¢éƒ¨ç½²æ¶æ„                               |
