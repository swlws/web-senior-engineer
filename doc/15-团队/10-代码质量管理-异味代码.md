# å¼‚å‘³ä»£ç 

ä»£ç è´¨é‡ç®¡ç†ä¸­çš„ â€œä»£ç å¼‚å‘³ï¼ˆCode Smellï¼‰â€ æŒ‡çš„æ˜¯ï¼š

> ä»£ç æ²¡æœ‰ç›´æ¥å¯¼è‡´è¿è¡Œé”™è¯¯ï¼Œä½†ä»è®¾è®¡ã€å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§ã€æ‰©å±•æ€§ç­‰è§’åº¦çœ‹ï¼Œå­˜åœ¨æ½œåœ¨é—®é¢˜æˆ–æœªæ¥å¯èƒ½æ¶åŒ–çš„è¿¹è±¡ã€‚

ä¸€èˆ¬å¯åˆ†ä¸º 5 å¤§ç±»ã€20+ å¸¸è§å¼‚å‘³ï¼Œä¸‹é¢ç»™ä½ æŒ‰å·¥ç¨‹å¸ˆè§†è§’ã€ç®€æ˜åˆ†ç±»æ¢³ç†ğŸ‘‡

## âœ… ä¸€ã€ç»“æ„ç±»å¼‚å‘³ï¼ˆStructure Smellsï¼‰

æ¶‰åŠæ¨¡å—/ç±»/å‡½æ•°çš„ç»“æ„ä¸è§„æ¨¡é—®é¢˜ã€‚

1. è¿‡é•¿å‡½æ•°ï¼ˆLong Functionï¼‰
  å‡½æ•°é€»è¾‘è¿‡äºåºå¤§ï¼ŒèŒè´£ä¸æ¸…ã€éš¾ç»´æŠ¤ã€‚
2. è¿‡å¤§çš„ç±»ï¼ˆLarge Classï¼‰
  åŒ…å«å¤ªå¤šå­—æ®µã€æ–¹æ³•ã€é€»è¾‘ï¼Œè¿åå•ä¸€èŒè´£ã€‚
3. è¿‡æ·±çš„åµŒå¥—ï¼ˆDeep Nestingï¼‰
  å¤šå±‚ if/for/switchï¼Œä»£ç é˜…è¯»å›°éš¾ã€‚
4. è¿‡é•¿å‚æ•°åˆ—è¡¨ï¼ˆLong Parameter Listï¼‰
  å‚æ•°è¶…è¿‡ 3ï½5 ä¸ªéœ€é‡æ„ï¼ˆå¯å°è£…åˆ°å¯¹è±¡ï¼‰ã€‚
5. é‡å¤ä»£ç ï¼ˆDuplicated Codeï¼‰
  é¡¹ç›®ä¸­å¤šå¤„é€»è¾‘ç›¸åŒæˆ–ç›¸ä¼¼ã€‚
6. æ•°æ®æ³¥å›¢ï¼ˆData Clumpsï¼‰
  å¤šä¸ªå­—æ®µæ€»æ˜¯æˆç»„å‡ºç°ï¼Œåº”å°è£…ä¸ºå¯¹è±¡ã€‚

## âœ… äºŒã€è®¾è®¡ç±»å¼‚å‘³ï¼ˆDesign Smellsï¼‰

ä¸é¢å‘å¯¹è±¡è®¾è®¡ã€æ¨¡å—è¾¹ç•Œæœ‰å…³ã€‚

1. è¿‡å¼ºè€¦åˆï¼ˆTight Couplingï¼‰
  æ¨¡å—/ç±»é—´ä¾èµ–è¿‡å¤šï¼Œä¿®æ”¹ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚
2. å¾ªç¯ä¾èµ–ï¼ˆCyclic Dependenciesï¼‰
  A ä¾èµ– Bï¼ŒB åˆä¾èµ– Aï¼Œä¸æ˜“æµ‹è¯•æˆ–æ‰©å±•ã€‚
3. æ•£å¼¹å¼ä¿®æ”¹ï¼ˆShotgun Surgeryï¼‰
  ä¸€ä¸ªéœ€æ±‚å˜æ›´è¦ä¿®æ”¹å¤šä¸ªæ–‡ä»¶ã€‚
4. å‘æ•£å¼å˜åŒ–ï¼ˆDivergent Changeï¼‰
  ä¸€ä¸ªç±»è´Ÿè´£å¤ªå¤šä¸åŒå˜åŒ–åŸå› ï¼ˆè¿å SRPï¼‰ã€‚
5. ä¸å¤Ÿé€šç”¨çš„æ¥å£ï¼ˆInappropriate Abstractionï¼‰
  æŠ½è±¡è®¾è®¡ä¸å¥½ï¼šè¿‡åº¦æˆ–ä¸è¶³æŠ½è±¡ã€‚
6. ç‰¹æ€§å«‰å¦’ï¼ˆFeature Envyï¼‰
  ä¸€ä¸ªæ–¹æ³•å¤ªå…³å¿ƒå…¶ä»–å¯¹è±¡çš„æ•°æ®ï¼Œè€Œä¸æ˜¯è‡ªèº«ã€‚

## âœ… ä¸‰ã€å‘½åä¸å¯è¯»æ€§å¼‚å‘³ï¼ˆReadability Smellsï¼‰

ä¸ä»£ç ç†è§£å’Œæ²Ÿé€šæˆæœ¬æœ‰å…³ã€‚

1. å«ç³Š/é”™è¯¯å‘½åï¼ˆPoor Namingï¼‰
  å˜é‡/å‡½æ•°åæ— æ³•è¡¨è¾¾å…¶å«ä¹‰ã€‚
2. é­”æ³•æ•°å­—ï¼ˆMagic Numbersï¼‰
  ç¡¬ç¼–ç çš„æ•°å­—æˆ–å­—ç¬¦ä¸²æ²¡æœ‰è¯­ä¹‰è¯´æ˜ã€‚
3. è¿‡é•¿/éš¾æ‡‚çš„è¡¨è¾¾å¼
  ä¸‰ç›®åµŒå¥—ã€å¤æ‚æ¡ä»¶åˆ¤æ–­ç­‰ã€‚
4. æ— æ„ä¹‰æ³¨é‡Š / è¿‡åº¦æ³¨é‡Š
  æ³¨é‡Šé‡å¤è¡¨è¾¾ä»£ç æœ¬èº«å«ä¹‰ã€‚

## âœ… å››ã€çŠ¶æ€ä¸é€»è¾‘æ§åˆ¶å¼‚å‘³ï¼ˆState & Logic Smellsï¼‰

1. å‘½ä»¤ä¸æŸ¥è¯¢æ··åˆï¼ˆCommandâ€“Query Mixedï¼‰
  æ–¹æ³•æ—¢è¿”å›æ•°æ®åˆä¿®æ”¹çŠ¶æ€ã€‚
2. å¤šå¤„æ¡ä»¶åˆ†æ”¯åˆ†æ•£ï¼ˆSwitch / If Overuseï¼‰
  å¤§é‡æ¡ä»¶é€»è¾‘ï¼Œåº”è¯¥å¤šæ€æˆ–ç­–ç•¥æ¨¡å¼ã€‚
3. é”™è¯¯å¤„ç†ä¸ä¸€è‡´
  æœ‰äº›ç”¨ try/catchã€æœ‰äº›è¿”å›ç‰¹æ®Šå€¼ã€æœ‰äº›é™é»˜å¤±è´¥ã€‚
4. å¸ƒå°”å‚æ•°ï¼ˆBoolean Parameterï¼‰
  æš´éœ²å†…éƒ¨æµç¨‹ï¼Œåº”æ‹†åˆ†æ–¹æ³•ã€‚

## âœ… äº”ã€å·¥ç¨‹ä¸æ¶æ„å¼‚å‘³ï¼ˆProject-Level Smellsï¼‰

1. God Objectï¼ˆä¸Šå¸ç±»ï¼‰
  ä¸€ä¸ªæ¨¡å—æ‰¿æ‹…å¤ªå¤šèŒè´£ï¼Œæ‰€æœ‰é€»è¾‘éƒ½ä¾èµ–å®ƒã€‚
2. åˆ†å±‚æ¶æ„ç ´åï¼ˆLayer Violationï¼‰
  ä¾‹å¦‚é¡µé¢å±‚ç›´æ¥æ“ä½œæ•°æ®åº“ã€‚
3. æœªä½¿ç”¨çš„ä»£ç ï¼ˆDead Codeï¼‰
  æ°¸è¿œä¸ä¼šè¿è¡Œæˆ–æ²¡äººè°ƒç”¨çš„ä»£ç ã€‚
4. æ¨¡å—è¾¹ç•Œæ¨¡ç³Š
  é…ç½®ã€çŠ¶æ€ã€æœåŠ¡ã€å·¥å…·æ··åœ¨ä¸€èµ·ã€‚

## â­ å¸¸è§ä¸ºä»€ä¹ˆå«â€œå¼‚å‘³ï¼ˆSmellï¼‰â€ï¼Ÿ

å› ä¸ºå®ƒä»¬`ä¸æ˜¯ bug`ï¼Œä½†ä¼šå¯¼è‡´ï¼š

- é€»è¾‘è¶Šæ¥è¶Šéš¾ç»´æŠ¤
- æ–°éœ€æ±‚æ—¶ä¿®æ”¹æˆæœ¬æé«˜
- Bug æ›´å®¹æ˜“å‡ºç°
- å›¢é˜Ÿæ²Ÿé€šä¸åä½œå›°éš¾
- å®ƒä»¬æ˜¯ä»£ç è´¨é‡ä¸‹é™çš„ ä¿¡å·ã€‚

---

## å¯ç”¨çš„ `.eslintrc.js`

```js
module.exports = {
  root: true,
  env: {
    browser: true,
    node: true,
    es2021: true
  },
  parserOptions: {
    ecmaVersion: 2021,
    sourceType: "module"
  },
  extends: [
    "eslint:recommended"
  ],
  plugins: [
    "import",
    "promise"
    // "react",
    // "react-hooks",
    // "vue"
  ],
  rules: {
    /* ============================
     * 1. ç»“æ„ç±»å¼‚å‘³ï¼ˆStructure Smellsï¼‰
     * ============================ */
    "max-lines": ["warn", { max: 500, skipBlankLines: true, skipComments: true }],
    "max-lines-per-function": ["warn", { max: 80, skipBlankLines: true, skipComments: true }],
    "max-depth": ["warn", 4],
    "max-params": ["warn", 4],
    "max-nested-callbacks": ["warn", 3],
    "max-statements": ["warn", 20],

    "no-duplicate-imports": "error",
    "no-duplicate-case": "error",
    "no-dupe-else-if": "error",
    "no-duplicate-keys": "error",

    /* ============================
     * 2. å¯è¯»æ€§ & å‘½åï¼ˆReadability Smellsï¼‰
     * ============================ */
    "camelcase": "warn",
    "id-length": ["warn", { min: 2, exceptions: ["i", "j", "k", "_"] }],
    "no-magic-numbers": ["warn", { ignore: [0, 1, -1], ignoreArrayIndexes: true, enforceConst: true }],

    "complexity": ["warn", 10],
    "no-nested-ternary": "warn",
    "no-negated-condition": "warn",
    "no-else-return": "warn",
    "no-warning-comments": "warn",

    /* ============================
     * 3. é€»è¾‘æ§åˆ¶ç±»ï¼ˆLogic Smellsï¼‰
     * ============================ */
    "no-constant-condition": "warn",
    "no-empty": ["error", { allowEmptyCatch: true }],
    "default-case": "warn",
    "no-lonely-if": "warn",
    "no-unreachable-loop": "warn",

    /* ============================
     * 4. é”™è¯¯å¤„ç†ï¼ˆError Handling Smellsï¼‰
     * ============================ */
    "no-throw-literal": "error",
    "promise/always-return": "warn",
    "promise/no-nesting": "warn",
    "promise/catch-or-return": "warn",

    /* ============================
     * 5. å·¥ç¨‹ç±»ï¼ˆProject Smellsï¼‰
     * ============================ */
    "no-unused-vars": ["warn", { argsIgnorePattern: "^_" }],
    "no-unreachable": "error",

    "import/no-unused-modules": ["warn", { unusedExports: true }],
    "import/no-cycle": ["warn", { maxDepth: 2 }],
    "import/no-unresolved": "error",
    "import/order": ["warn", { "newlines-between": "always" }],
    "sort-imports": ["warn", { ignoreDeclarationSort: true }]
  }
};
```
