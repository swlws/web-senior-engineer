# 数字签名

数字签名（Digital Signature）是 验证数据完整性和身份真实性的一种密码学技术，本质上是 “加密 + 哈希 + 公钥验证” 的组合。下面我帮你系统梳理一下。

## 1️⃣ 数字签名的目的

- 身份认证：确认消息发送者的身份
- 数据完整性：保证消息在传输过程中未被篡改
- 不可抵赖性：发送者不能否认自己发送过消息

## 2️⃣ 数字签名的工作原理（以 RSA 为例）

假设 Alice 给 Bob 发消息：

1. 哈希摘要
   - Alice 对消息 M 生成哈希摘要：

     ```ini
     digest = SHA-256(M)
     ```

   - 这里的 SHA-256 可以换成 SHA-1、SHA-512 等。
2. 私钥加密摘要
   - Alice 使用 RSA 私钥 对摘要进行加密，生成签名：

    ```ini
     signature = RSA_private_encrypt(digest)
    ```

   - 签名长度 = RSA 密钥长度（比如 2048 位）。
3. 发送消息 + 签名
   - Alice 将消息 M 和签名一起发送给 Bob。
4. 公钥验证签名
   - Bob 使用 Alice 的 RSA 公钥 解密签名，得到摘要：

    ```ini
     digest_from_signature = RSA_public_decrypt(signature)
     ```

   - Bob 对收到的消息 M 再计算 SHA-256 摘要：

     ```ini
     digest_new = SHA-256(M)
     ```

   - 如果 digest_from_signature === digest_new，则验证通过。

## 3️⃣ 流程图简化

```txt
消息 M
   │
   ▼
SHA-256(M) --------> 哈希摘要
   │
   ▼
RSA 私钥加密 --------> 数字签名
   │
   ▼
消息 + 签名 ----> 接收方
                       │
                       ▼
                  RSA 公钥解密
                       │
                       ▼
                 得到摘要
                       │
                 SHA-256(M) 新摘要
                       │
                 对比一致？ ✅
```

## 4️⃣ 浏览器中实现示例（RSA-SHA256 签名）

```js
// 导入私钥
const privateKey = await crypto.subtle.importKey(
  "pkcs8",
  pemToArrayBuffer(privateKeyPem),
  { name: "RSASSA-PKCS1-v1_5", hash: "SHA-256" },
  false,
  ["sign"]
);

// 签名
const encoder = new TextEncoder();
const data = encoder.encode("Hello World");
const signature = await crypto.subtle.sign("RSASSA-PKCS1-v1_5", privateKey, data);

// Base64 输出
const signatureBase64 = arrayBufferToBase64(signature);
```

验证签名：

```js
const publicKey = await crypto.subtle.importKey(
  "spki",
  pemToArrayBuffer(publicKeyPem),
  { name: "RSASSA-PKCS1-v1_5", hash: "SHA-256" },
  false,
  ["verify"]
);

const isValid = await crypto.subtle.verify(
  "RSASSA-PKCS1-v1_5",
  publicKey,
  base64ToArrayBuffer(signatureBase64),
  encoder.encode("Hello World")
);

console.log(isValid); // true / false
```

## 5️⃣ 总结

数字签名 = 哈希 + 私钥加密

验证签名 = 公钥解密 + 对比哈希

保证：身份 + 完整性 + 不可抵赖
