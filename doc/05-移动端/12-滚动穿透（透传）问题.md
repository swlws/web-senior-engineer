# æ»šåŠ¨ç©¿é€ï¼ˆé€ä¼ ï¼‰é—®é¢˜

è¿™æ˜¯ç§»åŠ¨ç«¯ / WebView å¿…è¸©å‘ä¹‹ä¸€

## ä¸€ã€ä»€ä¹ˆæ˜¯ã€Œæ»šåŠ¨ç©¿é€ï¼ˆé€ä¼ ï¼‰ã€

> å½“å‰å±‚åœ¨æ»šåŠ¨æˆ–æ»‘åŠ¨æ—¶ï¼Œåº•å±‚é¡µé¢ä¹Ÿè·Ÿç€æ»šåŠ¨ã€‚

å…¸å‹åœºæ™¯ï¼š

- å¼¹çª— / Drawer / ActionSheet æ‰“å¼€
- åº•å±‚é¡µé¢è¿˜èƒ½æ»š
- iOS ä¸Šå°¤ä¸ºæ˜æ˜¾

## äºŒã€ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæ»šåŠ¨ç©¿é€ï¼Ÿï¼ˆæ ¹å› ï¼‰

æµè§ˆå™¨çš„æ»šåŠ¨å½’å±è§„åˆ™ï¼ˆæ ¸å¿ƒï¼‰

1. æ»šåŠ¨æ˜¯ç³»ç»Ÿçº§è¡Œä¸º
2. æµè§ˆå™¨ä¼šæŠŠæ»šåŠ¨â€œäº¤ç»™æœ€è¿‘çš„å¯æ»šåŠ¨ç¥–å…ˆâ€
3. å½“å‰å…ƒç´  æ»šåŠ¨åˆ°è¾¹ç•Œ åï¼š
   - ğŸ‘‰ æ»šåŠ¨ä¼š å†’æ³¡ç»™çˆ¶çº§
   - ğŸ‘‰ ç›´åˆ° body / viewport

è¿™å«ï¼šScroll Chainingï¼ˆæ»šåŠ¨é“¾ï¼‰

## ä¸‰ã€æ»šåŠ¨ç©¿é€çš„ä¸‰å¤§ç±»å‹ï¼ˆå¿…ä¼šï¼‰

### â‘  body è¿˜èƒ½æ»šï¼ˆæœ€å¸¸è§ï¼‰

```txt
å¼¹çª—æ»šåŠ¨ â†’ body ä¹Ÿåœ¨æ»š
```

åŸå› ï¼š

- body æœ¬èº«å¯æ»š
- å¼¹çª—æ²¡æ‹¦ä½æ»šåŠ¨

### â‘¡ å¼¹çª—æ»šåˆ°åº• â†’ åº•å±‚å¼€å§‹æ»šï¼ˆiOS ç»å…¸ï¼‰

```txt
å¼¹çª— scrollTop = 0
ç»§ç»­ä¸‹æ»‘ â†’ é¡µé¢æ»š

```

åŸå› ï¼š

- iOS çš„ rubber band + scroll chaining

### â‘¢ touch äº‹ä»¶é˜»æ­¢äº†ï¼Œä½†æ»šåŠ¨ä»å‘ç”Ÿï¼ˆæœ€å‘ï¼‰

åŸå› ï¼š

- passive listener
- body æ»šåŠ¨ä¸å—æ§
- iOS ç‰¹æ®Šæœºåˆ¶

## å››ã€âŒ é”™è¯¯ / è¿‡æ—¶æ–¹æ¡ˆï¼ˆè¸©é›·åŒºï¼‰

### âŒ æ–¹æ¡ˆ 1ï¼štouchmove + preventDefaultï¼ˆå…¨å±€ï¼‰

```js
document.addEventListener("touchmove", (e) => {
  e.preventDefault();
});
```

é—®é¢˜ï¼š

- iOS ä»å¯èƒ½æ»š
- Chrome éœ€è¦ passive:false
- é˜»æ–­æ•´ä¸ªé¡µé¢äº¤äº’
- æ€§èƒ½å·®

### âŒ æ–¹æ¡ˆ 2ï¼šåªç¦ç”¨å¼¹çª—æ»šåŠ¨

```css
.modal {
  overflow: hidden;
}
```

ğŸ‘‰ åº•å±‚ç…§æ ·æ»š

## äº”ã€ç°ä»£æ­£ç¡®æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### âœ… æ–¹æ¡ˆä¸€ï¼šCSS overscroll-behaviorï¼ˆé¦–é€‰ï¼‰

```css
.modal {
  overscroll-behavior: contain;
}
```

æˆ–ï¼š

```css
.modal {
  overscroll-behavior: none;
}
```

å«ä¹‰

- é˜»æ­¢æ»šåŠ¨é“¾å‘ä¸Šä¼ é€’
- ä¸å½±å“å†…éƒ¨æ»šåŠ¨

ğŸ“Œ Chrome / Android / iOS 16+ æ”¯æŒè‰¯å¥½

### âœ… æ–¹æ¡ˆäºŒï¼šé” body æ»šåŠ¨ï¼ˆæœ€é€šç”¨ï¼‰

> æ ¸å¿ƒæ€è·¯: è®© body ä¸å†å¯æ»š

æ¨èå®ç°ï¼ˆiOS å®‰å…¨ç‰ˆï¼‰

```js
let scrollTop = 0;

function lockBody() {
  scrollTop = window.scrollY;
  document.body.style.position = "fixed";
  document.body.style.top = `-${scrollTop}px`;
  document.body.style.width = "100%";
}

function unlockBody() {
  document.body.style.position = "";
  document.body.style.top = "";
  window.scrollTo(0, scrollTop);
}
```

### âœ… æ–¹æ¡ˆä¸‰ï¼špointer + touch-actionï¼ˆç°ä»£äº¤äº’ï¼‰

```css
.overlay {
  touch-action: none;
}
.modal {
  touch-action: pan-y;
}
```

å«ä¹‰

- é®ç½©å±‚ç¦æ­¢æ»šåŠ¨
- å¼¹çª—åªå…è®¸è‡ªèº«æ»š

ğŸ‘‰ ä¸ä¾èµ– JS

### âœ… æ–¹æ¡ˆå››ï¼šé˜»æ–­ touchmoveï¼ˆå…œåº•ï¼‰

```js
overlay.addEventListener("touchmove", (e) => e.preventDefault(), {
  passive: false,
});
```

## å…­ã€ä¸åŒå¹³å°ç­–ç•¥æ¨èï¼ˆå®æˆ˜ï¼‰

| å¹³å°           | æ¨èæ–¹æ¡ˆ                |
| -------------- | ----------------------- |
| iOS Safari     | body fixed + overscroll |
| iOS WebView    | body fixedï¼ˆå¿…é€‰ï¼‰      |
| Android Chrome | overscroll              |
| å¾®ä¿¡ WebView   | body fixed              |
| PC             | overflow: hidden        |

## ä¸ƒã€å®Œæ•´å¼¹çª—é˜²ç©¿é€æ–¹æ¡ˆï¼ˆå·¥ç¨‹çº§ï¼‰

```css
.modal {
  max-height: 80vh;
  overflow-y: auto;
  overscroll-behavior: contain;
}
```

```js
openModal() {
  lockBody()
}

closeModal() {
  unlockBody()
}
```

## å…«ã€ä¸ºä»€ä¹ˆ iOS ç‰¹åˆ«å®¹æ˜“ç©¿é€ï¼Ÿ

| åŸå›             | è§£é‡Š                      |
| --------------- | ------------------------- |
| Rubber band     | å›å¼¹æ»šåŠ¨                  |
| Scroll Chaining | æ»šåŠ¨å‘ä¸Šä¼ é€’              |
| body ç‰¹æ®Š       | iOS body ä¸æ˜¯çœŸæ­£æ»šåŠ¨å®¹å™¨ |
| passive é»˜è®¤    | preventDefault å¤±æ•ˆ       |

## æ€»ç»“

- æ»šåŠ¨ç©¿é€çš„æœ¬è´¨æ˜¯ Scroll Chainingï¼šå½“å½“å‰å®¹å™¨æ— æ³•ç»§ç»­æ»šåŠ¨æ—¶ï¼Œæ»šåŠ¨è¡Œä¸ºä¼šä¼ é€’ç»™çˆ¶çº§ç”šè‡³ bodyï¼›
- iOS ä¸Šç”±äº rubber band å’Œ body æ»šåŠ¨æœºåˆ¶æ›´å®¹æ˜“å‡ºç°ï¼›
- ç°ä»£è§£å†³æ–¹æ¡ˆä¼˜å…ˆä½¿ç”¨ overscroll-behavior é˜»æ–­æ»šåŠ¨é“¾ï¼Œ
- æˆ–åœ¨å¼¹çª—æ‰“å¼€æ—¶é€šè¿‡ position: fixed é”å®š bodyï¼Œ
- å¯¹å¤æ‚äº¤äº’å¯é…åˆ pointer events + touch-action æ§åˆ¶æ»šåŠ¨ã€‚
