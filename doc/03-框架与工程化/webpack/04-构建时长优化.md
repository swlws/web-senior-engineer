# Webpack 构建时长优化

## 🌟 一、基础配置优化

### 1. 使用 mode: 'production' 或 mode: 'development'

- 开发环境使用 development，构建更快，启用缓存等优化。
- 生产环境使用 production，启用压缩等优化。

### 2. 使用 devtool 设置合适的 source map

- 开发阶段建议使用：
  ```js
  devtool: "cheap-module-source-map";
  ```
- 建速度与调试质量之间做权衡。

## 🚀 二、模块解析优化（Resolve）

### 1. 设置 resolve.extensions

避免无谓的后缀尝试。

```js
resolve: {
  extensions: [".js", ".jsx", ".ts", ".tsx", ".json"];
}
```

### 2. 设置 alias

减少查找路径深度。

```js
alias: {
  '@': path.resolve(__dirname, 'src')
}
```

### 3. 缩小 include 范围

例如 Babel loader：

```js
{
  test: /\.js$/,
  include: path.resolve(__dirname, 'src'),
  use: 'babel-loader'
}
```

## 🧱 三、Loader 优化

### 1. 避免对 node_modules 目录转译

```js
exclude: /node_modules/;
```

### 2. 使用多线程 loader（如 thread-loader）

适合 CPU 密集型任务（如 Babel）：

```js
{
  test: /\.js$/,
  include: path.resolve(__dirname,'src'),
  use: ['thread-loader','babel-loader']
}
```

### 3. 使用缓存 loader（如 cache-loader 或 babel-loader 的 cacheDirectory）

```js
{
  loader: 'babel-loader',
  options: {
    cacheDirectory: true
  }
}
```

## 📦 四、Plugin 优化

### 1. 避免不必要的插件（如无用的分析、压缩插件）

### 2. 使用 webpack.IgnorePlugin

减少 moment 等库的语言包体积：

```js
new webpack.IgnorePlugin({
  resourceRegExp: /^\.\/locale$/,
  contextRegExp: /moment$/,
});
```

### 3. 开启持久化缓存（Webpack 5+）

```js
cache: {
  type: "filesystem";
}
```

## 📁 五、构建体积优化（间接影响构建时间）

### 1. Tree Shaking

使用 ES Module + sideEffects: false

### 2. 动态引入组件/模块（Code Splitting）

### 3. 替换大型库

如：

- lodash → lodash-es + babel-plugin-lodash
- moment → dayjs

## 🧪 六、构建分析与调优工具

### 1. 使用 webpack-bundle-analyzer

查看打包体积与模块依赖。

### 2. 使用 speed-measure-webpack-plugin

分析构建各阶段耗时。

### 3. 使用 profile 和 stats 输出

```bash
webpack --profile --json > stats.json
```

## 🌐 七、开发模式下的优化（webpack-dev-server）

1. 开启 HMR（Hot Module Replacement）
2. 减少开发时插件、压缩逻辑
3. 使用 webpack-dev-middleware（结合 express 可减少 IO）

## ⏱ 八、CI/CD 构建优化策略

1. 增量构建（使用 Git diff 判断构建目录）
2. 并行构建（例如分包、模块化构建）
3. 缓存 node_modules 与构建产物（如 GitHub Actions Cache）
