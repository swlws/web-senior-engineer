# 块级格式化上下文

BFC 是一块独立的布局环境。
在这块区域中，元素的布局不会影响外部，也不会被外部所影响。

## 🎯 BFC 触发方式

| 触发方式                              | 示例                       |
| --------------------------------- | ------------------------ |
| `float` 不为 `none`                 | `float: left;`           |
| `position` 为 `absolute` 或 `fixed` | `position: absolute;`    |
| `display` 为 `inline-block`        | `display: inline-block;` |
| `display` 为 `flow-root`（推荐，最语义的）  | `display: flow-root;`    |
| `overflow` 不为 `visible`           | `overflow: hidden/auto`  |
| `display: flex/grid` 的容器          | `display: flex;`         |

最常用的：

- overflow: hidden;
- display: flow-root;（现代布局推荐）

## 📌 BFC 能解决哪些问题？

为什么要有 BFC？它能解决哪些经典问题？

### 1）解决浮动高度塌陷（最常考🔥）

当子元素浮动后，父元素高度可能变成 0
→ 使用 BFC 可以让父元素包含浮动子元素

❌ 未触发 BFC，高度塌陷

```html
<div class="parent">
  <div class="child"></div>
</div>

.parent { border: 1px solid red; }
.child { float:left; width:100px; height:100px; background:#09f; }
```

父元素高度变 0。

✅ 使用 BFC 修复

```html
.parent {
  overflow: hidden; /* 或 display: flow-root */
}
```

### 2）避免 margin 合并（margin collapse）

❌ 示例：兄弟元素的 margin 合并

```html
<div class="a"></div>
<div class="b"></div>

.a { margin-bottom:20px; height:50px; background:#aaa; }
.b { margin-top:20px; height:50px; background:#bbb; }

```

实际间距 不是 40px，而是 20px（合并）

✅ 使用 BFC 阻止 margin 合并

```html
<div class="a"></div>
<div class="wrapper">
  <div class="b"></div>
</div>


.a { margin-bottom:20px; height:50px; background:#aaa; }
.b { margin-top:20px; height:50px; background:#bbb; }
.wrapper { display: flow-root }
```

### 3）避免文字环绕（float 绕排问题）

当左侧有一个浮动元素时，右边的文字会自动环绕它。

比如布局中需要让右边 block 不被 float 元素影响，可以触发 BFC。

❌ 未触发 BFC

右侧被左侧浮动影响，文字被挤压。

✅ 使用 BFC

```html
.right {
  overflow: hidden;
}
```

这样右侧元素不会被浮动元素覆盖或挤压。

### 4）阻止 absolutely positioned 元素影响布局

当一个元素成为 BFC 时，它能隔离绝对定位元素对正常文档流的影响，这在复杂布局时非常有用。

## 🌈 BFC 的核心规则

总结为 4 条：

- 内部的盒子会在垂直方向一个接一个放置
- 同一个 BFC 中的两个盒子 margin 会合并，但 不同 BFC 不会
- BFC 会包含浮动元素，不会重叠
- BFC 不会与 float 元素重叠，会避开浮动

## 📝 面试回答模板

- BFC 是一个独立的布局环境，里面的元素布局不会受到外部影响。
- 它的典型触发方式包括 overflow: hidden、display: flow-root、float、position: absolute 等。
- 主要作用是：清除浮动、避免高度塌陷、阻止 margin 合并、避免浮动环绕影响布局。
- 实际开发中我最常用 display: flow-root 或 overflow: hidden 来解决父元素高度塌陷或 margin 合并问题。

## 示例

父子级外边距塌陷

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>父子 margin 塌陷示例</title>
  <style>
    .parent {
      width: 200px;
      height: 100px;
      background: lightblue;
      /* ❌ 注意：这里不能有 padding/border/overflow 才会塌陷 */
    }

    .child {
      width: 100px;
      height: 50px;
      background: pink;
      margin-top: 50px; /* ★ 触发父子 margin 塌陷 */
    }
  </style>
</head>
<body>
  <div class="parent">
    <div class="child"></div>
  </div>
</body>
</html>

```
